import{r as d,j as e,y as N,f as S}from"./index-quAWpIA7.js";import{R as $}from"./refresh-cw-BoTFdhd7.js";import{m as c}from"./proxy-D7LjGbFl.js";import{A as B}from"./index-5ncPk15p.js";import{H as v}from"./hard-drive-DPqZp4MO.js";function E(){const[l,p]=d.useState(0),[i,g]=d.useState(0),[n,o]=d.useState(!1),[x,j]=d.useState(new Set),h=8,t=2,a=h/t;d.useEffect(()=>{if(!n)return;const r=setInterval(()=>{g(s=>s+1>=a?(p(b=>b+1>=a?(o(!1),0):b+1),0):s+1)},600);return()=>clearInterval(r)},[n,a]),d.useEffect(()=>{const r=`${l}-${i}`;j(s=>new Set([...s,r]))},[l,i]);const k=()=>{p(0),g(0),o(!1),j(new Set)},w=(r,s)=>r===l&&s===i,y=(r,s)=>x.has(`${r}-${s}`);return e.jsx("div",{className:"p-8 h-full overflow-y-auto",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-amber-600 dark:text-amber-400 mb-4",children:"How Tiling Works"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-300 max-w-2xl mx-auto",children:["Flash Attention processes the attention matrix in ",e.jsx("strong",{children:"small tiles"})," that fit in SRAM. Each tile is computed, combined with running statistics, and the results are accumulated without ever materializing the full attention matrix."]})]}),e.jsxs("div",{className:"flex justify-center gap-4 mb-8",children:[e.jsxs("button",{onClick:()=>o(!n),className:`px-6 py-3 rounded-xl font-medium transition-colors shadow-lg ${n?"bg-red-500 hover:bg-red-600 text-white":"bg-amber-500 hover:bg-amber-600 text-white"}`,children:[n?"Pause":"Start"," Animation"]}),e.jsxs("button",{onClick:k,className:"px-6 py-3 bg-slate-200 dark:bg-slate-700 rounded-xl font-medium hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors flex items-center gap-2",children:[e.jsx($,{size:18}),"Reset"]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"font-bold text-slate-700 dark:text-slate-200 mb-4 text-center",children:["Attention Matrix (",h,"Ã—",h,") with Tiles"]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -top-6 left-0 right-0 text-center text-sm font-medium text-blue-600 dark:text-blue-400",children:"K (Keys) â†’"}),e.jsx("div",{className:"absolute -left-8 top-0 bottom-0 flex items-center",children:e.jsx("span",{className:"text-sm font-medium text-purple-600 dark:text-purple-400 transform -rotate-90",children:"Q (Queries)"})}),e.jsx("div",{className:"grid gap-1 ml-4",style:{gridTemplateColumns:`repeat(${a}, 1fr)`},children:Array.from({length:a}).map((r,s)=>Array.from({length:a}).map((b,u)=>{const m=w(s,u),f=y(s,u)&&!m;return e.jsx(c.div,{animate:{scale:m?1.1:1,boxShadow:m?"0 0 20px rgba(245, 158, 11, 0.5)":"none"},className:`
                                                        w-16 h-16 rounded-lg border-2 p-1
                                                        flex items-center justify-center
                                                        ${m?"border-amber-500 bg-amber-100 dark:bg-amber-900/40":f?"border-emerald-400 bg-emerald-50 dark:bg-emerald-900/20":"border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50"}
                                                    `,children:e.jsx("div",{className:"grid grid-cols-2 gap-0.5",children:Array.from({length:t*t}).map((z,A)=>e.jsx("div",{className:`w-3 h-3 rounded-sm ${m?"bg-amber-500":f?"bg-emerald-400":"bg-slate-300 dark:bg-slate-500"}`},A))})},`${s}-${u}`)}))})]})}),e.jsxs("div",{className:"flex justify-center gap-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-amber-500 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Current Tile"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-emerald-400 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Processed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-slate-300 dark:bg-slate-500 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Pending"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"font-bold text-slate-700 dark:text-slate-200 mb-4",children:"Current Operation"}),e.jsx(B,{mode:"wait",children:e.jsxs(c.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded font-mono text-sm",children:["Q[",l*t,":",(l+1)*t,"]"]}),e.jsx("span",{className:"text-slate-400",children:"Ã—"}),e.jsxs("div",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded font-mono text-sm",children:["K[",i*t,":",(i+1)*t,"]"]})]}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Processing tile (",l,", ",i,") â†’ Computing ",t,"Ã—",t," = ",t*t," attention scores"]})]},`${l}-${i}`)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 text-white",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Memory Data Flow"}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(v,{size:32,className:"mx-auto text-red-400 mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"HBM"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Q, K, V blocks"})]}),e.jsx(c.div,{animate:{x:[0,10,0]},transition:{repeat:1/0,duration:1},children:e.jsx(N,{size:24,className:"text-amber-400"})}),e.jsxs(c.div,{className:"text-center",animate:{scale:n?[1,1.1,1]:1},transition:{repeat:1/0,duration:.6},children:[e.jsx(S,{size:32,className:"mx-auto text-emerald-400 mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"SRAM"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Tile compute"})]}),e.jsx(c.div,{animate:{x:[0,10,0]},transition:{repeat:1/0,duration:1,delay:.5},children:e.jsx(N,{size:24,className:"text-amber-400"})}),e.jsxs("div",{className:"text-center",children:[e.jsx(v,{size:32,className:"mx-auto text-blue-400 mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"HBM"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Output O"})]})]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-2xl p-6",children:[e.jsx("h3",{className:"font-bold text-amber-700 dark:text-amber-400 mb-2",children:'ðŸ”‘ The "Online Softmax" Trick'}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Flash Attention uses ",e.jsx("strong",{children:"running statistics"})," (max and sum) to compute the correct softmax across tiles without seeing all values at once. Each tile updates these accumulators, producing the exact same result as standard attention!"]})]})]})]}),e.jsxs("div",{className:"mt-8 bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Tiles Processed"}),e.jsxs("span",{className:"font-mono text-amber-600",children:[x.size," / ",a*a]})]}),e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx(c.div,{className:"h-full bg-gradient-to-r from-amber-500 to-orange-500",animate:{width:`${x.size/(a*a)*100}%`}})})]})]})})}export{E as default};
