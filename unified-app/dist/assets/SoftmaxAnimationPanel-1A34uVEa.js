import{r as y,j as c}from"./index-BmgLEcVh.js";import{S as we,C as ye,m as ve,W as Se,G as Ce,n as Ee,c as ke,d as je,L as Ae,E as ze,o as Ne,p as L,q as $,r as G}from"./three.module-DCYoyzkr.js";import{g as C}from"./index-CH_iu5NA.js";const F=[2,1,.1],P=F.map(g=>Math.exp(g)),U=P.reduce((g,v)=>g+v,0),Q=P.map(g=>g/U),N={logit:6003669,exp:7384391,sum:7352480,prob:15564081,bg:16777215},u=[{id:"show-logits",title:"Input Logits (z)",desc:"The raw scores (logits) from the previous layer: [2.0, 1.0, 0.1]"},{id:"calc-exp",title:"Exponentiation (e^z)",desc:`Apply exponential function to each logit to make them positive.
e^2.0 ≈ 7.39, e^1.0 ≈ 2.72, e^0.1 ≈ 1.11`},{id:"calc-sum",title:"Sum of Exponentials (Σ)",desc:"Sum all exponential values: 7.39 + 2.72 + 1.11 ≈ 11.21"},{id:"normalize",title:"Normalization (e^z / Σ)",desc:`Divide each exponential by the sum to get probabilities.
7.39/11.21 ≈ 0.66`},{id:"result",title:"Resulting Probabilities",desc:"Final probabilities sum to 1.0: [0.66, 0.24, 0.10]"}];function Me({onStepChange:g}){const v=y.useRef(null),V=y.useRef(null),Z=y.useRef(null),I=y.useRef({}),[m,R]=y.useState(0),[h,X]=y.useState(!1),[ee,E]=y.useState("Click Play to see how Softmax works");y.useEffect(()=>{g&&g(m,F,Q)},[m,g]),y.useEffect(()=>{if(!v.current)return;const s=v.current.clientWidth,t=400,e=new we;e.background=new ye(N.bg),Z.current=e;const p=new ve(s/-2,s/2,t/2,t/-2,.1,1e3);p.position.z=100;const S=new Se({antialias:!0});S.setSize(s,t),v.current.appendChild(S.domElement),V.current=S;const n=50,x=10,T=(a,o,k,d,r,j=!0)=>{const i=new Ce,l=new Ee(n,n),pe=new ke({color:d,transparent:!0,opacity:.8}),J=new je(l,pe);i.add(J);const xe=new Ae(new ze(l),new Ne({color:3355443,linewidth:2}));i.add(xe);const M=document.createElement("canvas");M.width=256,M.height=128;const A=M.getContext("2d");A.fillStyle="black",A.font="bold 40px Arial",A.textAlign="center",A.textBaseline="middle",A.fillText(typeof a=="number"?a.toFixed(2):a,128,64);const be=new L(M),fe=new $({map:be,transparent:!0}),K=new G(fe);if(K.scale.set(n*1.5,n*.75,1),i.add(K),r){const B=document.createElement("canvas");B.width=256,B.height=64;const z=B.getContext("2d");z.fillStyle="#333",z.font="bold 32px Arial",z.textAlign="center",z.textBaseline="middle",z.fillText(r,128,32);const ge=new L(B),he=new $({map:ge,transparent:!0}),D=new G(he);D.scale.set(n*1.5,n*.4,1),D.position.y=n*.8,i.add(D)}return i.position.set(o,k,0),i.visible=j,i.userData={value:a,mesh:J},e.add(i),i},_=(a,o,k=0)=>{const d=document.createElement("canvas");d.width=128,d.height=128;const r=d.getContext("2d");r.fillStyle="#333",r.font="bold 80px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText("→",64,64);const j=new L(d),i=new $({map:j}),l=new G(i);return l.scale.set(40,40,1),l.position.set(a,o,0),l.material.rotation=k,l.visible=!1,e.add(l),l},q=(a,o,k)=>{const d=document.createElement("canvas");d.width=128,d.height=128;const r=d.getContext("2d");r.fillStyle="#333",r.font="bold 80px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText(a,64,64);const j=new L(d),i=new $({map:j}),l=new G(i);return l.scale.set(40,40,1),l.position.set(o,k,0),l.visible=!1,e.add(l),l},b=-200,f=100,w=150,oe=F.map((a,o)=>T(a,b,f-o*(n+x+20),N.logit,o===0?"z":"",!1)),ne=P.map((a,o)=>T(a,b+w,f-o*(n+x+20),N.exp,o===0?"e^z":"",!1)),le=F.map((a,o)=>_(b+w/2,f-o*(n+x+20))),re=T(U,b+w*1.5,f-3*(n+x+20),N.sum,"Σ",!1),ie=[q("+",b+w,f-.5*(n+x+20)),q("+",b+w,f-1.5*(n+x+20))],ce=_(b+w,f-2.5*(n+x+20),-Math.PI/2),de=Q.map((a,o)=>T(a,b+w*2.5,f-o*(n+x+20),N.prob,o===0?"p":"",!1)),ue=P.map((a,o)=>_(b+w*1.75,f-o*(n+x+20))),me=P.map((a,o)=>q("/",b+w*1.75,f-o*(n+x+20)+20));I.current={logitCells:oe,expCells:ne,sumCell:re,probCells:de,arrows1:le,arrows2:ue,arrowToSum:ce,plusSymbols:ie,divSymbols:me};let Y;const H=()=>{Y=requestAnimationFrame(H),S.render(e,p)};return H(),()=>{var a;cancelAnimationFrame(Y),S.dispose(),(a=v.current)!=null&&a.contains(S.domElement)&&v.current.removeChild(S.domElement)}},[]);const O=s=>{const t=I.current;switch(s){case 1:t.logitCells.forEach((e,p)=>{e.visible=!0,e.scale.set(.01,.01,.01),C.to(e.scale,{x:1,y:1,z:1,duration:.5,delay:p*.1,ease:"back.out"})});break;case 2:t.arrows1.forEach(e=>e.visible=!0),t.expCells.forEach((e,p)=>{e.visible=!0,e.scale.set(.01,.01,.01),C.to(e.scale,{x:1,y:1,z:1,duration:.5,delay:p*.1,ease:"back.out"})});break;case 3:t.plusSymbols.forEach(e=>e.visible=!0),t.arrowToSum.visible=!0,t.sumCell.visible=!0,t.sumCell.scale.set(.01,.01,.01),t.expCells.forEach(e=>{C.to(e.scale,{x:1.2,y:1.2,duration:.2,yoyo:!0,repeat:1})}),C.to(t.sumCell.scale,{x:1,y:1,z:1,duration:.5,delay:.5,ease:"back.out"});break;case 4:t.arrows2.forEach(e=>e.visible=!0),t.divSymbols.forEach(e=>e.visible=!0),C.to(t.sumCell.scale,{x:1.2,y:1.2,duration:.2,yoyo:!0,repeat:1}),t.probCells.forEach((e,p)=>{e.visible=!0,e.scale.set(.01,.01,.01),C.to(e.scale,{x:1,y:1,z:1,duration:.5,delay:.5+p*.1,ease:"back.out"})});break;case 5:t.probCells.forEach((e,p)=>{C.to(e.scale,{x:1.2,y:1.2,duration:.3,yoyo:!0,repeat:1,delay:p*.1})});break}},te=async()=>{if(!h){X(!0),W();for(let s=0;s<u.length;s++)R(s+1),E(`${u[s].title}
${u[s].desc}`),O(s+1),await new Promise(t=>setTimeout(t,2e3));E("Complete! Softmax converts logits to probabilities."),X(!1)}},se=()=>{if(h||m>=u.length)return;const s=m+1;R(s),E(`${u[s-1].title}
${u[s-1].desc}`),O(s)},ae=()=>{if(h||m<=0)return;W();const s=m-1;setTimeout(()=>{for(let t=1;t<=s;t++)O(t);R(s),s>0&&E(`${u[s-1].title}
${u[s-1].desc}`)},100)},W=()=>{if(h)return;const s=I.current;Object.values(s).flat().forEach(t=>{t&&(t.visible=!1)}),R(0),E("Click Play to see how Softmax works")};return c.jsxs("div",{className:"flex flex-col items-center p-3",children:[c.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Softmax Animation"}),c.jsx("div",{ref:v,className:"w-full rounded-lg overflow-hidden shadow-lg bg-white"}),c.jsx("div",{className:"mt-2 p-2 bg-white rounded-lg w-full text-center shadow h-20 flex items-center justify-center",children:c.jsx("p",{className:"text-gray-800 whitespace-pre-line text-sm",children:ee})}),c.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[c.jsx("button",{onClick:ae,disabled:h||m<=0,className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"← Prev"}),c.jsxs("div",{className:"px-3 py-1 bg-gray-200 rounded-lg font-mono text-gray-700 min-w-[80px] text-center text-sm",children:[m," / ",u.length]}),c.jsx("button",{onClick:se,disabled:h||m>=u.length,className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"Next →"})]}),c.jsxs("div",{className:"flex gap-2 mt-2",children:[c.jsx("button",{onClick:te,disabled:h||m>=u.length,className:"px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:h?"Playing...":"▶ Play"}),c.jsx("button",{onClick:W,disabled:h,className:"px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"↺ Reset"})]})]})}export{Me as default};
