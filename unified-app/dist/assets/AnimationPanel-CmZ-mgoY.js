import{r as p,j as n}from"./index-CsxpOLHd.js";import{S as ne,C as oe,O as ie,W as ce,G as de,P as ue,M as me,a as be,L as he,E as pe,b as xe,e as X,f as Y,g as F}from"./three.module-CNl0Zq82.js";import{g as x}from"./index-C8pce-KX.js";const ge=[[3,1],[0,2]],fe=[[1,0],[0,1]],we=[[3,1],[0,2]],k={matrixA:15564081,matrixQ:6003669,matrixR:7384391,bg:16777215},o=[{id:"show-a",title:"Original Matrix A",desc:"A is a 2×2 matrix to decompose"},{id:"gram-schmidt-1",title:"Gram-Schmidt Step 1",desc:"Normalize first column: q₁ = a₁ / ||a₁||"},{id:"gram-schmidt-2",title:"Gram-Schmidt Step 2",desc:"Orthogonalize: a₂ - (a₂·q₁)q₁, then normalize"},{id:"show-q",title:"Matrix Q (Orthonormal)",desc:"Q has orthonormal columns: Q^T Q = I"},{id:"show-r",title:"Matrix R (Upper Triangular)",desc:"R is upper triangular with Q^T A = R"},{id:"decomp",title:"QR Decomposition",desc:"A = QR (product of orthogonal and upper triangular)"}];function Se(){const f=p.useRef(null),U=p.useRef(null),H=p.useRef(null),[c,j]=p.useState(0),[d,L]=p.useState(!1),[J,R]=p.useState("Click Play to see QR decomposition (Gram-Schmidt)"),i=p.useRef({cellsA:[],cellsQ:[],cellsR:[],labels:[]});p.useEffect(()=>{if(!f.current)return;i.current={cellsA:[],cellsQ:[],cellsR:[],labels:[]};const t=f.current.clientWidth,e=400,s=new ne;s.background=new oe(k.bg),U.current=s;const m=new ie(t/-2,t/2,e/2,e/-2,.1,1e3);m.position.z=100;const g=new ce({antialias:!0});g.setSize(t,e),f.current.appendChild(g.domElement);const b=40,w=4,N=(a,l,u,S,y=!0)=>{const r=new de,E=new ue(b,b),q=new me({color:S,transparent:!0,opacity:.8}),h=new be(E,q);r.add(h);const le=new he(new pe(E),new xe({color:3355443,linewidth:2}));r.add(le);const A=document.createElement("canvas");A.width=128,A.height=128;const Q=A.getContext("2d");Q.fillStyle="black",Q.font="bold 50px Arial",Q.textAlign="center",Q.textBaseline="middle",Q.fillText(a.toString(),64,64);const I=new X(A),re=new Y({map:I,transparent:!0}),W=new F(re);return W.scale.set(30,30,1),r.add(W),r.position.set(l,u,0),r.visible=y,r.userData={value:a,mesh:h,canvas:A,texture:I},s.add(r),r},v=(a,l,u,S=32)=>{const y=document.createElement("canvas");y.width=512,y.height=128;const r=y.getContext("2d");r.fillStyle="black",r.font=`bold ${S*2}px Arial`,r.textAlign="center",r.textBaseline="middle",r.fillText(a,256,64);const E=new X(y),q=new Y({map:E}),h=new F(q);return h.scale.set(a.length*S/2,S,1),h.position.set(l,u,0),h.visible=!1,s.add(h),h},P=-30,T=100;for(let a=0;a<2;a++)for(let l=0;l<2;l++){const u=N(ge[a][l],P+l*(b+w),T-a*(b+w),k.matrixA,!1);i.current.cellsA.push(u)}const _=v("A",P+22,T+50);i.current.labels.push(_);const M=-150,G=0;for(let a=0;a<2;a++)for(let l=0;l<2;l++){const u=N(fe[a][l],M+l*(b+w),G-a*(b+w),k.matrixQ,!1);i.current.cellsQ.push(u)}const ee=v("Q",M+22,G+60);i.current.labels.push(ee);const O=20,$=0;for(let a=0;a<2;a++)for(let l=0;l<2;l++){const u=N(we[a][l],O+l*(b+w),$-a*(b+w),k.matrixR,!1);i.current.cellsR.push(u)}const te=v("R",O+22,$+60);i.current.labels.push(te);const se=v("×",M+100,G,28),ae=v("=",P-40,T-20,32);i.current.labels.push(se,ae),H.current=g;let D;const B=()=>{D=requestAnimationFrame(B),g.render(s,m)};return B(),()=>{var a;cancelAnimationFrame(D),g.dispose(),(a=f.current)!=null&&a.contains(g.domElement)&&f.current.removeChild(g.domElement)}},[]);const C=t=>{const e=i.current;switch(t){case 1:e.cellsA.forEach((s,m)=>{s.visible=!0,s.scale.set(.01,.01,.01),x.to(s.scale,{x:1,y:1,z:1,duration:.4,delay:m*.1,ease:"back.out"})}),e.labels[0].visible=!0;break;case 2:e.cellsA.slice(0,2).forEach(s=>{x.to(s.scale,{x:1.2,y:1.2,duration:.3})}),setTimeout(()=>e.cellsA.slice(0,2).forEach(s=>x.to(s.scale,{x:1,y:1,duration:.3})),1e3);break;case 3:e.cellsA.slice(2).forEach(s=>{x.to(s.scale,{x:1.2,y:1.2,duration:.3})}),setTimeout(()=>e.cellsA.slice(2).forEach(s=>x.to(s.scale,{x:1,y:1,duration:.3})),1e3);break;case 4:e.labels[1].visible=!0,e.cellsQ.forEach((s,m)=>{s.visible=!0,s.scale.set(.01,.01,.01),x.to(s.scale,{x:1,y:1,z:1,duration:.4,delay:m*.08,ease:"back.out"})}),e.labels[3].visible=!0;break;case 5:e.labels[2].visible=!0,e.cellsR.forEach((s,m)=>{s.visible=!0,s.scale.set(.01,.01,.01),x.to(s.scale,{x:1,y:1,z:1,duration:.4,delay:m*.08,ease:"back.out"})}),e.labels[4].visible=!0;break;case 6:[...e.cellsQ,...e.cellsR].forEach(s=>{x.to(s.userData.mesh.material,{opacity:.3,duration:.2,yoyo:!0,repeat:2})});break}},K=async()=>{if(!d){L(!0);for(let t=c;t<o.length;t++)j(t+1),R(`${o[t].title}
${o[t].desc}`),C(t+1),await new Promise(e=>setTimeout(e,1600));R("Complete! QR = orthonormal Q × upper triangular R"),L(!1)}},V=()=>{if(d||c>=o.length)return;const t=c+1;j(t),R(`${o[t-1].title}
${o[t-1].desc}`),C(t)},Z=()=>{if(d||c<=0)return;z();const t=c-1;setTimeout(()=>{for(let e=1;e<=t;e++)C(e);j(t),t>0&&R(`${o[t-1].title}
${o[t-1].desc}`)},100)},z=()=>{if(d)return;const t=i.current;[...t.cellsA,...t.cellsQ,...t.cellsR].forEach(e=>{e&&(e.visible=!1,e.scale.set(1,1,1),e.userData.mesh&&(e.userData.mesh.material.opacity=.8))}),t.labels.forEach(e=>{e&&(e.visible=!1)}),j(0),R("Click Play to see QR decomposition (Gram-Schmidt)")};return n.jsxs("div",{className:"flex flex-col items-center p-3",children:[n.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Animation Demo"}),n.jsx("div",{ref:f,className:"w-full rounded-lg overflow-hidden shadow-lg bg-white"}),n.jsx("div",{className:"mt-2 p-2 bg-white rounded-lg w-full text-center shadow",children:n.jsx("p",{className:"text-gray-800 whitespace-pre-line text-sm",children:J})}),n.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.jsx("button",{onClick:Z,disabled:d||c<=0,className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"← Prev"}),n.jsxs("div",{className:"px-3 py-1 bg-gray-200 rounded-lg font-mono text-gray-700 min-w-[80px] text-center text-sm",children:[c," / ",o.length]}),n.jsx("button",{onClick:V,disabled:d||c>=o.length,className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"Next →"})]}),n.jsxs("div",{className:"flex gap-2 mt-2",children:[n.jsx("button",{onClick:K,disabled:d||c>=o.length,className:"px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:d?"Playing...":"▶ Play"}),n.jsx("button",{onClick:z,disabled:d,className:"px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"↺ Reset"})]}),n.jsx("div",{className:"mt-2 p-2 bg-green-100 rounded-lg w-full text-center border border-green-300",children:n.jsx("p",{className:"text-green-800 text-xs font-medium",children:"A = QR | Q^T Q = I | R upper triangular"})})]})}export{Se as default};
