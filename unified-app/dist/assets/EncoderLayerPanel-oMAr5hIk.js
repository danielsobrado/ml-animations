import{r as l,j as e,m as h,e as g}from"./index-quAWpIA7.js";import{P as p}from"./pause-Ch50eX2B.js";import{P as y}from"./play-DgR7o5cW.js";function k(){const[t,c]=l.useState(0),[n,i]=l.useState(!1),[r,x]=l.useState(!0),[j,u]=l.useState(null),d=[{title:"Input Embeddings",description:"Token, segment, and position embeddings are summed and enter the first encoder layer."},{title:"Multi-Head Self-Attention",description:"12 attention heads process the input in parallel, each learning different patterns."},{title:"Add & Normalize (1)",description:"Residual connection adds original input, then Layer Normalization stabilizes training."},{title:"Feed-Forward Network",description:"Two linear layers with GELU activation: 768 ‚Üí 3072 ‚Üí 768. Processes each position independently."},{title:"Add & Normalize (2)",description:"Another residual connection and Layer Normalization produce the final layer output."},{title:"Stack 12 Layers",description:"This entire block repeats 12 times (BERT-Base) or 24 times (BERT-Large)."}];l.useEffect(()=>{if(n){const o=setInterval(()=>{c(s=>s>=d.length-1?(i(!1),s):s+1)},3e3);return()=>clearInterval(o)}},[n]);const m=()=>{c(0),i(!1)},a=o=>t>=[0,1,2,3,4,5][o]?1:.3;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-2",children:["BERT ",e.jsx("span",{className:"text-yellow-400",children:"Encoder Layer"})," Architecture"]}),e.jsx("p",{className:"text-gray-800 dark:text-gray-400",children:"Inside one Transformer encoder block - repeated 12√ó in BERT-Base"})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsxs("button",{onClick:()=>i(!n),className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg transition-colors",children:[n?e.jsx(p,{size:18}):e.jsx(y,{size:18}),n?"Pause":"Play Animation"]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors",children:[e.jsx(h,{size:18}),"Reset"]}),e.jsxs("button",{onClick:()=>x(!r),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${r?"bg-green-600":"bg-white/10 hover:bg-white/20"}`,children:[e.jsx(g,{size:18}),r?"Hide":"Show"," Residuals"]})]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:d.map((o,s)=>e.jsx("button",{onClick:()=>{c(s),i(!1)},className:`px-3 py-1 rounded-full text-sm transition-all ${s===t?"bg-yellow-500 text-black":s<t?"bg-yellow-900 text-yellow-300":"bg-white/10 text-gray-700 dark:text-gray-500"}`,children:s+1},s))}),e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-500/30 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-bold text-yellow-400",children:["Step ",t+1,": ",d[t].title]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mt-1",children:d[t].description})]}),e.jsx("div",{className:"bg-black/30 rounded-2xl p-6 border border-white/10",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[t>=5&&e.jsx("div",{className:"absolute -left-16 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"bg-orange-900/30 border border-orange-500 rounded-lg px-2 py-8",children:e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 writing-mode-vertical transform -rotate-180",style:{writingMode:"vertical-rl"},children:"√ó 12 Layers"})})}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:`w-48 p-3 rounded-lg border-2 transition-all duration-500 ${t>=0?"bg-blue-900/30 border-blue-500":"bg-gray-800/30 border-gray-600"}`,style:{opacity:a(0)},children:[e.jsx("p",{className:"text-center text-sm font-medium text-blue-300",children:"Input Embeddings"}),e.jsx("p",{className:"text-center text-xs text-gray-800 dark:text-gray-400",children:"[batch, seq_len, 768]"})]}),e.jsx("div",{className:"text-gray-700 dark:text-gray-500",children:"‚Üì"}),e.jsxs("div",{className:`w-48 p-3 rounded-lg border-2 transition-all duration-500 ${t>=1?"bg-yellow-900/30 border-yellow-500":"bg-gray-800/30 border-gray-600"}`,style:{opacity:a(1)},children:[e.jsx("p",{className:"text-center text-sm font-medium text-yellow-300",children:"Multi-Head Attention"}),e.jsx("p",{className:"text-center text-xs text-gray-800 dark:text-gray-400",children:"12 heads √ó 64 dims"})]}),r&&e.jsx("div",{className:"absolute left-[-40px] top-[60px] h-[100px] w-[30px]",children:e.jsxs("svg",{className:"w-full h-full",style:{opacity:t>=2?1:.3},children:[e.jsx("path",{d:"M 30 0 L 0 0 L 0 100 L 30 100",fill:"none",stroke:"#22c55e",strokeWidth:"2",strokeDasharray:"4"}),e.jsx("polygon",{points:"25,95 30,100 25,105",fill:"#22c55e"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-500",children:"‚Üì"}),r&&e.jsx("span",{className:"text-xs",children:"+ residual"})]}),e.jsxs("div",{className:`w-48 p-3 rounded-lg border-2 transition-all duration-500 ${t>=2?"bg-green-900/30 border-green-500":"bg-gray-800/30 border-gray-600"}`,style:{opacity:a(2)},children:[e.jsx("p",{className:"text-center text-sm font-medium text-green-300",children:"Add & LayerNorm"}),e.jsx("p",{className:"text-center text-xs text-gray-800 dark:text-gray-400",children:"x + Attention(x)"})]}),e.jsx("div",{className:"text-gray-700 dark:text-gray-500",children:"‚Üì"}),e.jsxs("div",{className:`w-48 p-4 rounded-lg border-2 transition-all duration-500 ${t>=3?"bg-purple-900/30 border-purple-500":"bg-gray-800/30 border-gray-600"}`,style:{opacity:a(3)},children:[e.jsx("p",{className:"text-center text-sm font-medium text-purple-300",children:"Feed-Forward Network"}),e.jsxs("div",{className:"flex flex-col items-center mt-2 text-xs text-gray-800 dark:text-gray-400",children:[e.jsx("span",{children:"Linear: 768 ‚Üí 3072"}),e.jsx("span",{className:"text-purple-600 dark:text-purple-400",children:"GELU activation"}),e.jsx("span",{children:"Linear: 3072 ‚Üí 768"})]})]}),r&&e.jsx("div",{className:"absolute left-[-40px] top-[230px] h-[120px] w-[30px]",children:e.jsxs("svg",{className:"w-full h-full",style:{opacity:t>=4?1:.3},children:[e.jsx("path",{d:"M 30 0 L 0 0 L 0 120 L 30 120",fill:"none",stroke:"#22c55e",strokeWidth:"2",strokeDasharray:"4"}),e.jsx("polygon",{points:"25,115 30,120 25,125",fill:"#22c55e"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-500",children:"‚Üì"}),r&&e.jsx("span",{className:"text-xs",children:"+ residual"})]}),e.jsxs("div",{className:`w-48 p-3 rounded-lg border-2 transition-all duration-500 ${t>=4?"bg-green-900/30 border-green-500":"bg-gray-800/30 border-gray-600"}`,style:{opacity:a(4)},children:[e.jsx("p",{className:"text-center text-sm font-medium text-green-300",children:"Add & LayerNorm"}),e.jsx("p",{className:"text-center text-xs text-gray-800 dark:text-gray-400",children:"x + FFN(x)"})]}),e.jsx("div",{className:"text-gray-700 dark:text-gray-500",children:"‚Üì"}),e.jsxs("div",{className:`w-48 p-3 rounded-lg border-2 transition-all duration-500 ${t>=4?"bg-orange-900/30 border-orange-500":"bg-gray-800/30 border-gray-600"}`,style:{opacity:a(5)},children:[e.jsx("p",{className:"text-center text-sm font-medium text-orange-300",children:"Layer Output"}),e.jsx("p",{className:"text-center text-xs text-gray-800 dark:text-gray-400",children:"[batch, seq_len, 768]"})]})]})]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-900/20 rounded-xl p-4 border border-green-500/30",children:[e.jsx("h4",{className:"font-bold text-green-400 mb-3",children:"üìä Layer Normalization"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Normalizes across the feature dimension (not batch), stabilizing training:"}),e.jsx("div",{className:"bg-black/30 rounded-lg p-3",children:e.jsx("code",{className:"text-xs text-green-300",children:"LayerNorm(x) = Œ≥ * (x - Œº) / ‚àö(œÉ¬≤ + Œµ) + Œ≤"})}),e.jsxs("ul",{className:"text-xs text-gray-800 dark:text-gray-400 mt-2 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Œº, œÉ computed per token (across 768 dims)"}),e.jsx("li",{children:"‚Ä¢ Œ≥, Œ≤ are learned parameters"}),e.jsx("li",{children:"‚Ä¢ Helps with vanishing/exploding gradients"})]})]}),e.jsxs("div",{className:"bg-purple-900/20 rounded-xl p-4 border border-purple-500/30",children:[e.jsx("h4",{className:"font-bold text-purple-600 dark:text-purple-400 mb-3",children:"üîß Feed-Forward Network"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Position-wise FFN with expansion factor 4:"}),e.jsx("div",{className:"bg-black/30 rounded-lg p-3",children:e.jsx("code",{className:"text-xs text-purple-300",children:"FFN(x) = GELU(xW‚ÇÅ + b‚ÇÅ)W‚ÇÇ + b‚ÇÇ"})}),e.jsxs("ul",{className:"text-xs text-gray-800 dark:text-gray-400 mt-2 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ W‚ÇÅ: [768, 3072] - expansion"}),e.jsx("li",{children:"‚Ä¢ W‚ÇÇ: [3072, 768] - contraction"}),e.jsx("li",{children:"‚Ä¢ GELU: smooth ReLU alternative"}),e.jsx("li",{children:"‚Ä¢ Processes each position independently"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-900/20 to-blue-900/20 rounded-xl p-4 border border-green-500/30",children:[e.jsx("h4",{className:"font-bold text-green-400 mb-3",children:"üîÑ Residual Connections (Skip Connections)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:e.jsx("strong",{children:"Why Residuals?"})}),e.jsxs("ul",{className:"text-sm text-gray-800 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Enable training of very deep networks (12+ layers)"}),e.jsx("li",{children:"‚Ä¢ Gradient flows directly through skip path"}),e.jsx("li",{children:'‚Ä¢ Each layer learns a "modification" to input'}),e.jsx("li",{children:"‚Ä¢ Prevents vanishing gradients"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:e.jsx("strong",{children:"Mathematical Form:"})}),e.jsx("div",{className:"bg-black/30 rounded-lg p-3",children:e.jsx("code",{className:"text-sm text-green-300",children:"output = LayerNorm(x + SubLayer(x))"})}),e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-500 mt-2",children:'BERT uses "post-norm": LayerNorm after residual addition'})]})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-xl p-4 border border-white/10",children:[e.jsx("h4",{className:"font-bold text-purple-600 dark:text-purple-400 mb-3",children:"üåä GELU Activation (Gaussian Error Linear Unit)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Used instead of ReLU in BERT:"}),e.jsx("div",{className:"bg-black/30 rounded-lg p-3",children:e.jsxs("code",{className:"text-xs text-purple-300",children:["GELU(x) = x * Œ¶(x)",e.jsx("br",{}),"‚âà 0.5x(1 + tanh(‚àö(2/œÄ)(x + 0.044715x¬≥)))"]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Properties:"}),e.jsxs("ul",{className:"text-xs text-gray-800 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Smooth, non-monotonic"}),e.jsx("li",{children:"‚Ä¢ Allows small negative values"}),e.jsx("li",{children:"‚Ä¢ Weights inputs by their magnitude"}),e.jsx("li",{children:"‚Ä¢ Better for NLP than ReLU"})]})]})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-xl p-4 border border-white/10",children:[e.jsx("h4",{className:"font-bold text-yellow-400 mb-3",children:"üìà BERT Model Statistics"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/20",children:[e.jsx("th",{className:"text-left py-2 text-gray-800 dark:text-gray-400",children:"Component"}),e.jsx("th",{className:"text-center py-2 text-gray-800 dark:text-gray-400",children:"BERT-Base"}),e.jsx("th",{className:"text-center py-2 text-gray-800 dark:text-gray-400",children:"BERT-Large"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"py-2",children:"Encoder Layers"}),e.jsx("td",{className:"text-center font-mono",children:"12"}),e.jsx("td",{className:"text-center font-mono",children:"24"})]}),e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"py-2",children:"Hidden Size"}),e.jsx("td",{className:"text-center font-mono",children:"768"}),e.jsx("td",{className:"text-center font-mono",children:"1024"})]}),e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"py-2",children:"Attention Heads"}),e.jsx("td",{className:"text-center font-mono",children:"12"}),e.jsx("td",{className:"text-center font-mono",children:"16"})]}),e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"py-2",children:"FFN Intermediate"}),e.jsx("td",{className:"text-center font-mono",children:"3072"}),e.jsx("td",{className:"text-center font-mono",children:"4096"})]}),e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"py-2",children:"Total Parameters"}),e.jsx("td",{className:"text-center font-mono text-green-400",children:"110M"}),e.jsx("td",{className:"text-center font-mono text-green-400",children:"340M"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2",children:"Max Sequence Length"}),e.jsx("td",{className:"text-center font-mono",children:"512"}),e.jsx("td",{className:"text-center font-mono",children:"512"})]})]})]})})]}),e.jsxs("div",{className:"bg-black/40 rounded-xl p-4 border border-white/10",children:[e.jsx("p",{className:"text-sm text-gray-800 dark:text-gray-400 mb-3",children:"üêç PyTorch Encoder Layer:"}),e.jsx("pre",{className:"text-sm overflow-x-auto",children:e.jsx("code",{className:"text-blue-300",children:`class BertEncoderLayer(nn.Module):
    def __init__(self, config):
        super().__init__()
        self.attention = MultiHeadAttention(config.hidden_size, config.num_heads)
        self.attention_norm = nn.LayerNorm(config.hidden_size)
        
        self.ffn = nn.Sequential(
            nn.Linear(config.hidden_size, config.intermediate_size),  # 768 ‚Üí 3072
            nn.GELU(),
            nn.Dropout(config.dropout),
            nn.Linear(config.intermediate_size, config.hidden_size),  # 3072 ‚Üí 768
            nn.Dropout(config.dropout)
        )
        self.ffn_norm = nn.LayerNorm(config.hidden_size)
    
    def forward(self, x, attention_mask=None):
        # Multi-Head Attention + Residual + LayerNorm
        attn_output = self.attention(x, attention_mask)
        x = self.attention_norm(x + attn_output)
        
        # Feed-Forward + Residual + LayerNorm
        ffn_output = self.ffn(x)
        x = self.ffn_norm(x + ffn_output)
        
        return x  # [batch, seq_len, 768]

class BertEncoder(nn.Module):
    def __init__(self, config):
        super().__init__()
        self.layers = nn.ModuleList([
            BertEncoderLayer(config) for _ in range(config.num_layers)
        ])
    
    def forward(self, x, attention_mask=None):
        for layer in self.layers:
            x = layer(x, attention_mask)
        return x`})})]})]})}export{k as default};
