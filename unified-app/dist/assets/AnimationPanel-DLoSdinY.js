import{r as f,j as c}from"./index-CsxpOLHd.js";import{S as de,C as ue,O as me,W as be,G as he,P as ge,M as xe,a as pe,L as fe,E as ye,b as ve,e as X,f as q,g as H}from"./three.module-CNl0Zq82.js";import{g as r}from"./index-C8pce-KX.js";const we=[[3,0],[4,5],[0,0]],Se=[[-.31,-.86,-.41],[-.95,.33,0],[0,-.38,.91]],Te=[[6.32,0],[0,2.24],[0,0]],Ve=[[-.63,-.77],[.77,-.63]],E={matrixA:15564081,matrixU:6003669,matrixSigma:7352480,matrixVT:7384391,bg:16777215},m=[{id:"show-a",title:"Original Matrix A",desc:"A is a 3×2 matrix we want to decompose"},{id:"intro-svd",title:"SVD Formula",desc:"A = U Σ V^T (Singular Value Decomposition)"},{id:"show-u",title:"Matrix U",desc:"U (3×3): Left singular vectors (orthonormal columns)"},{id:"show-sigma",title:"Matrix Σ",desc:"Σ (3×2): Diagonal matrix of singular values (σ₁ ≥ σ₂ ≥ 0)"},{id:"show-vt",title:"Matrix V^T",desc:"V^T (2×2): Right singular vectors transposed"},{id:"highlight-u",title:"U Properties",desc:"U^T U = I (orthonormal: columns are unit vectors, perpendicular)"},{id:"highlight-sigma",title:"Singular Values",desc:"σ₁ = 6.32, σ₂ = 2.24 (ordered: σ₁ ≥ σ₂)"},{id:"highlight-vt",title:"V^T Properties",desc:"V V^T = I (orthonormal vectors)"},{id:"reconstruct",title:"Reconstruction",desc:"Multiply U × Σ × V^T to get back A"}];function ke(){const w=f.useRef(null),J=f.useRef(null),K=f.useRef(null),[h,U]=f.useState(0),[g,I]=f.useState(!1),[Q,T]=f.useState("Click Play to see SVD step-by-step"),d=f.useRef({cellsA:[],cellsU:[],cellsSigma:[],cellsVT:[],labels:[]});f.useEffect(()=>{if(!w.current)return;d.current={cellsA:[],cellsU:[],cellsSigma:[],cellsVT:[],labels:[]};const s=w.current.clientWidth,t=450,e=new de;e.background=new ue(E.bg),J.current=e;const o=new me(s/-2,s/2,t/2,t/-2,.1,1e3);o.position.z=100;const y=new be({antialias:!0});y.setSize(s,t),w.current.appendChild(y.domElement);const b=36,x=3,j=(a,l,u,i,S=!0)=>{const n=new he,k=new ge(b,b),F=new xe({color:i,transparent:!0,opacity:.8}),p=new pe(k,F);n.add(p);const ne=new fe(new ye(k),new ve({color:3355443,linewidth:2}));n.add(ne);const V=document.createElement("canvas");V.width=128,V.height=128;const A=V.getContext("2d");A.fillStyle="black",A.font=a.toString().length>4?"bold 40px Arial":"bold 48px Arial",A.textAlign="center",A.textBaseline="middle",A.fillText(a.toString(),64,64);const W=new X(V),ce=new q({map:W,transparent:!0}),$=new H(ce);return $.scale.set(28,28,1),n.add($),n.position.set(l,u,0),n.visible=S,n.userData={value:a,originalColor:i,mesh:p,label:$,canvas:V,texture:W},e.add(n),n},v=(a,l,u,i=32)=>{const S=document.createElement("canvas");S.width=512,S.height=128;const n=S.getContext("2d");n.fillStyle="black",n.font=`bold ${i*2}px Arial`,n.textAlign="center",n.textBaseline="middle",n.fillText(a,256,64);const k=new X(S),F=new q({map:k}),p=new H(F);return p.scale.set(a.length*i/2,i,1),p.position.set(l,u,0),p.visible=!1,e.add(p),p},D=150,N=50,P=50,z=50,R=-50;for(let a=0;a<3;a++)for(let l=0;l<2;l++){const u=we[a][l].toFixed(0),i=j(u,R+l*(b+x),D-a*(b+x),E.matrixA,!1);d.current.cellsA.push(i)}const te=v("A",R+20,D+50);d.current.labels.push(te);const M=-220;for(let a=0;a<3;a++)for(let l=0;l<3;l++){const u=Se[a][l].toFixed(2),i=j(u,M+l*(b+x),N-a*(b+x),E.matrixU,!1);d.current.cellsU.push(i)}const se=v("U",M+60,N+70);d.current.labels.push(se);const L=-60;for(let a=0;a<3;a++)for(let l=0;l<2;l++){const u=Te[a][l].toFixed(2),i=j(u,L+l*(b+x),P-a*(b+x),E.matrixSigma,!1);d.current.cellsSigma.push(i)}const ae=v("Σ",L+20,P+70);d.current.labels.push(ae);const G=60;for(let a=0;a<2;a++)for(let l=0;l<2;l++){const u=Ve[a][l].toFixed(2),i=j(u,G+l*(b+x),z-a*(b+x),E.matrixVT,!1);d.current.cellsVT.push(i)}const le=v("V^T",G+20,z+70);d.current.labels.push(le);const re=v("×",M+130,N,28),oe=v("×",L+50,P,28),ie=v("=",R-70,D-40,32);d.current.labels.push(re,oe,ie),K.current=y;let O;const B=()=>{O=requestAnimationFrame(B),y.render(e,o)};return B(),()=>{var a;cancelAnimationFrame(O),y.dispose(),(a=w.current)!=null&&a.contains(y.domElement)&&w.current.removeChild(y.domElement)}},[]);const C=s=>{const t=d.current;switch(s){case 1:t.cellsA.forEach((e,o)=>{e.visible=!0,e.scale.set(.01,.01,.01),r.to(e.scale,{x:1,y:1,z:1,duration:.4,delay:o*.08,ease:"back.out"})}),t.labels[0].visible=!0;break;case 2:break;case 3:t.labels[1].visible=!0,t.cellsU.forEach((e,o)=>{e.visible=!0,e.scale.set(.01,.01,.01),r.to(e.scale,{x:1,y:1,z:1,duration:.4,delay:o*.05,ease:"back.out"})}),t.labels[4].visible=!0;break;case 4:t.labels[2].visible=!0,t.cellsSigma.forEach((e,o)=>{e.visible=!0,e.scale.set(.01,.01,.01),r.to(e.scale,{x:1,y:1,z:1,duration:.4,delay:o*.08,ease:"back.out"})}),t.labels[5].visible=!0;break;case 5:t.labels[3].visible=!0,t.cellsVT.forEach((e,o)=>{e.visible=!0,e.scale.set(.01,.01,.01),r.to(e.scale,{x:1,y:1,z:1,duration:.4,delay:o*.08,ease:"back.out"})}),t.labels[6].visible=!0;break;case 6:t.cellsU.forEach((e,o)=>{r.to(e.scale,{x:1.15,y:1.15,duration:.3,delay:o*.05}),r.to(e.userData.mesh.material,{opacity:1,duration:.3})}),setTimeout(()=>{t.cellsU.forEach(e=>{r.to(e.scale,{x:1,y:1,duration:.3}),r.to(e.userData.mesh.material,{opacity:.8,duration:.3})})},1200);break;case 7:t.cellsSigma.forEach((e,o)=>{e.userData.value!=="0.00"&&(r.to(e.scale,{x:1.2,y:1.2,duration:.3,delay:o*.1}),r.to(e.userData.mesh.material,{opacity:1,duration:.3}))}),setTimeout(()=>{t.cellsSigma.forEach(e=>{r.to(e.scale,{x:1,y:1,duration:.3}),r.to(e.userData.mesh.material,{opacity:.8,duration:.3})})},1200);break;case 8:t.cellsVT.forEach((e,o)=>{r.to(e.scale,{x:1.15,y:1.15,duration:.3,delay:o*.08}),r.to(e.userData.mesh.material,{opacity:1,duration:.3})}),setTimeout(()=>{t.cellsVT.forEach(e=>{r.to(e.scale,{x:1,y:1,duration:.3}),r.to(e.userData.mesh.material,{opacity:.8,duration:.3})})},1200);break;case 9:[...t.cellsU,...t.cellsSigma,...t.cellsVT].forEach(e=>{r.to(e.userData.mesh.material,{opacity:.3,duration:.2,yoyo:!0,repeat:2})}),t.cellsA.forEach(e=>{r.to(e.userData.mesh.material,{opacity:.5,duration:.2,yoyo:!0,repeat:3})});break}},Z=async()=>{if(!g){I(!0);for(let s=h;s<m.length;s++)U(s+1),T(`${m[s].title}
${m[s].desc}`),C(s+1),await new Promise(t=>setTimeout(t,1800));T("Complete! SVD decomposes A into orthogonal matrices (U, V^T) and singular values (Σ)."),I(!1)}},_=()=>{if(g||h>=m.length)return;const s=h+1;U(s),T(`${m[s-1].title}
${m[s-1].desc}`),C(s)},ee=()=>{if(g||h<=0)return;Y();const s=h-1;setTimeout(()=>{for(let t=1;t<=s;t++)C(t);U(s),s>0&&T(`${m[s-1].title}
${m[s-1].desc}`)},100)},Y=()=>{if(g)return;const s=d.current;[...s.cellsA,...s.cellsU,...s.cellsSigma,...s.cellsVT].forEach(t=>{t&&(t.visible=!1,t.scale.set(1,1,1),t.userData.mesh&&(t.userData.mesh.material.opacity=.8))}),s.labels.forEach(t=>{t&&(t.visible=!1)}),U(0),T("Click Play to see SVD step-by-step")};return c.jsxs("div",{className:"flex flex-col items-center p-3",children:[c.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Animation Demo"}),c.jsx("div",{ref:w,className:"w-full rounded-lg overflow-hidden shadow-lg bg-white"}),c.jsx("div",{className:"mt-2 p-2 bg-white rounded-lg w-full text-center shadow",children:c.jsx("p",{className:"text-gray-800 whitespace-pre-line text-sm",children:Q})}),c.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[c.jsx("button",{onClick:ee,disabled:g||h<=0,className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"← Prev"}),c.jsxs("div",{className:"px-3 py-1 bg-gray-200 rounded-lg font-mono text-gray-700 min-w-[80px] text-center text-sm",children:[h," / ",m.length]}),c.jsx("button",{onClick:_,disabled:g||h>=m.length,className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"Next →"})]}),c.jsxs("div",{className:"flex gap-2 mt-2",children:[c.jsx("button",{onClick:Z,disabled:g||h>=m.length,className:"px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:g?"Playing...":"▶ Play"}),c.jsx("button",{onClick:Y,disabled:g,className:"px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"↺ Reset"})]}),c.jsx("div",{className:"mt-2 p-2 bg-blue-100 rounded-lg w-full text-center border border-blue-300",children:c.jsx("p",{className:"text-blue-800 text-xs font-medium",children:"A = UΣV^T | U^TU = I, V^TV = I | Σ diagonal: σ₁ ≥ σ₂ ≥ ... ≥ 0"})})]})}export{ke as default};
