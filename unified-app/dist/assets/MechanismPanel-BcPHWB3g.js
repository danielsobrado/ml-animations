import{r as x,j as e,y as c,D as m,e as o}from"./index-quAWpIA7.js";import{m as r}from"./proxy-D7LjGbFl.js";function u(){const[t,i]=x.useState(3),a=["The","cat","sat","on","the","mat"],d=64;return e.jsx("div",{className:"p-8 h-full overflow-y-auto",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-emerald-600 dark:text-emerald-400 mb-4",children:"How KV Cache Works"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-300 max-w-2xl mx-auto",children:["The cache stores Key and Value matrices from previous tokens. When generating a new token, we only compute K and V for that token, then ",e.jsx("strong",{children:"append"})," them to the cache."]})]}),e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 rounded-xl p-6 mb-8",children:[e.jsxs("label",{className:"flex justify-between text-sm font-medium mb-3 dark:text-slate-300",children:[e.jsx("span",{children:"Current Generation Step"}),e.jsxs("span",{className:"text-emerald-600",children:["Token ",t+1,': "',a[t],'"']})]}),e.jsx("input",{type:"range",min:"0",max:a.length-1,value:t,onChange:l=>i(parseInt(l.target.value)),className:"w-full accent-emerald-500"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"Step 1"}),e.jsxs("span",{children:["Step ",a.length]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-emerald-500 text-white rounded-full flex items-center justify-center text-sm",children:"1"}),"New Token Input"]}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(r.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"px-6 py-4 bg-emerald-500 text-white rounded-xl font-mono text-xl font-bold shadow-lg",children:a[t]},t),e.jsx(c,{className:"text-slate-400"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Compute"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded font-mono text-sm",children:["K",e.jsx("sub",{children:"new"})]}),e.jsxs("div",{className:"px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded font-mono text-sm",children:["V",e.jsx("sub",{children:"new"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-emerald-500 text-white rounded-full flex items-center justify-center text-sm",children:"2"}),e.jsx(m,{size:18,className:"text-emerald-500"}),"KV Cache (Memory)"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-medium text-blue-600 dark:text-blue-400 mb-2",children:"Key Cache"}),e.jsx("div",{className:"flex gap-1",children:a.slice(0,t+1).map((l,s)=>e.jsxs(r.div,{initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},transition:{delay:s*.1},className:`h-8 w-8 rounded flex items-center justify-center text-xs font-mono ${s===t?"bg-blue-500 text-white ring-2 ring-blue-300":"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"}`,children:["K",s]},`k-${s}`))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-purple-600 dark:text-purple-400 mb-2",children:"Value Cache"}),e.jsx("div",{className:"flex gap-1",children:a.slice(0,t+1).map((l,s)=>e.jsxs(r.div,{initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},transition:{delay:s*.1},className:`h-8 w-8 rounded flex items-center justify-center text-xs font-mono ${s===t?"bg-purple-500 text-white ring-2 ring-purple-300":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:["V",s]},`v-${s}`))})]}),e.jsxs("div",{className:"mt-4 p-3 bg-slate-100 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Cache Size"}),e.jsxs("div",{className:"font-mono text-sm",children:["2 × ",t+1," × ",d," = ",e.jsx("span",{className:"text-emerald-600 font-bold",children:2*(t+1)*d})," floats"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-emerald-500 text-white rounded-full flex items-center justify-center text-sm",children:"3"}),"Attention Scores"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-slate-500 mb-2",children:["Q",e.jsx("sub",{children:"new"})," attends to all cached Keys:"]}),a.slice(0,t+1).map((l,s)=>{const n=s===t?.4:.6/t;return e.jsxs(r.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:s*.05},className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs w-12 text-slate-500",children:l}),e.jsx("div",{className:"flex-1 bg-slate-100 dark:bg-slate-700 rounded h-4 overflow-hidden",children:e.jsx(r.div,{initial:{width:0},animate:{width:`${n*100}%`},transition:{delay:.3+s*.05},className:`h-full ${s===t?"bg-emerald-500":"bg-blue-400"}`})}),e.jsxs("span",{className:"text-xs font-mono w-10 text-right text-slate-500",children:[(n*100).toFixed(0),"%"]})]},s)})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{size:32,className:"text-emerald-400"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg mb-2",children:"Memory Formula per Layer"}),e.jsx("code",{className:"text-emerald-300 font-mono",children:"Memory = 2 × seq_len × num_heads × head_dim × sizeof(float)"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"For a 7B model with 32 layers: each token adds ~1MB to the cache!"})]})]})})]})})}export{u as default};
