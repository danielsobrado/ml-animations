import{r as n,j as e,m as T,Z as $,f as P}from"./index-quAWpIA7.js";import{P as z}from"./pause-Ch50eX2B.js";import{P as A}from"./play-DgR7o5cW.js";import{H as M}from"./hard-drive-DPqZp4MO.js";import{m as N}from"./proxy-D7LjGbFl.js";function R(){const[m,u]=n.useState(!1),[d,w]=n.useState(16),[l,k]=n.useState(4),[c,g]=n.useState({row:0,col:0}),[i,f]=n.useState([]),a=Math.ceil(d/l),x=a*a,h=d*d*4/1024,j=l*l*4/1024,y=((h-j)/h*100).toFixed(1);n.useEffect(()=>{v()},[d,l]),n.useEffect(()=>{if(!m)return;const t=setInterval(()=>{g(s=>{const o=s.col+1;if(o>=a){const r=s.row+1;return r>=a?(u(!1),{row:0,col:0}):{row:r,col:0}}return{...s,col:o}})},200);return()=>clearInterval(t)},[m,a]),n.useEffect(()=>{if(m||i.length>0){const t=`${c.row}-${c.col}`;i.includes(t)||f(s=>[...s,t])}},[c,m]);const v=n.useCallback(()=>{u(!1),g({row:0,col:0}),f([])},[]),S=()=>{g(s=>{const o=s.col+1;if(o>=a){const r=s.row+1;return r>=a?s:{row:r,col:0}}return{...s,col:o}});const t=`${c.row}-${c.col}`;i.includes(t)||f(s=>[...s,t])},C=(t,s)=>{const o=`${t}-${s}`;return t===c.row&&s===c.col?"active":i.includes(o)?"processed":"pending"};return e.jsx("div",{className:"p-8 h-full overflow-y-auto",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-amber-600 dark:text-amber-400 mb-4",children:"Flash Attention Tiling Simulator"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"Adjust sequence length and block size to see how Flash Attention tiles the computation."})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"font-bold text-slate-700 dark:text-slate-200 mb-4",children:"Configuration"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex justify-between text-sm mb-2 dark:text-slate-300",children:[e.jsx("span",{children:"Sequence Length (N)"}),e.jsx("span",{className:"font-mono text-amber-600",children:d})]}),e.jsx("input",{type:"range",min:"8",max:"32",step:"4",value:d,onChange:t=>w(parseInt(t.target.value)),className:"w-full accent-amber-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex justify-between text-sm mb-2 dark:text-slate-300",children:[e.jsx("span",{children:"Block Size (B)"}),e.jsx("span",{className:"font-mono text-amber-600",children:l})]}),e.jsx("input",{type:"range",min:"2",max:"8",step:"2",value:l,onChange:t=>k(parseInt(t.target.value)),className:"w-full accent-amber-500"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-slate-100 dark:bg-slate-700/50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"text-slate-500",children:"Matrix Size:"}),e.jsxs("div",{className:"font-mono",children:[d,"×",d]}),e.jsx("div",{className:"text-slate-500",children:"Tiles per dim:"}),e.jsx("div",{className:"font-mono",children:a}),e.jsx("div",{className:"text-slate-500",children:"Total Tiles:"}),e.jsx("div",{className:"font-mono text-amber-600 font-bold",children:x})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:v,className:"p-3 rounded-full bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",children:e.jsx(T,{size:20})}),e.jsx("button",{onClick:()=>u(!m),className:"p-4 rounded-full bg-amber-500 text-white hover:bg-amber-600 transition-colors shadow-lg",children:m?e.jsx(z,{size:24}):e.jsx(A,{size:24})}),e.jsx("button",{onClick:S,disabled:i.length>=x,className:"px-4 py-2 rounded-lg bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 disabled:opacity-50 font-medium text-sm",children:"Step"})]}),e.jsxs("div",{className:"text-center mt-4 text-slate-500 text-sm",children:["Tile ",Math.min(i.length,x)," / ",x]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl p-6 text-white",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx($,{size:20}),"Memory Comparison"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{size:14}),"Standard Attention"]}),e.jsxs("span",{className:"font-mono",children:[h.toFixed(1)," KB"]})]}),e.jsx("div",{className:"h-3 bg-white/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-400 w-full"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{size:14}),"Flash Attention"]}),e.jsxs("span",{className:"font-mono",children:[j.toFixed(2)," KB"]})]}),e.jsx("div",{className:"h-3 bg-white/20 rounded-full overflow-hidden",children:e.jsx(N.div,{className:"h-full bg-emerald-400",animate:{width:`${j/h*100}%`}})})]}),e.jsxs("div",{className:"text-center pt-2 border-t border-white/20",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[y,"%"]}),e.jsx("span",{className:"text-sm ml-2",children:"memory reduction"})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"font-bold text-slate-700 dark:text-slate-200 mb-6 text-center",children:"Attention Matrix Tiling"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -top-8 left-0 right-0 text-center text-sm font-medium text-blue-600 dark:text-blue-400",children:"Keys (K)"}),e.jsx("div",{className:"absolute -left-10 top-0 bottom-0 flex items-center",children:e.jsx("span",{className:"text-sm font-medium text-purple-600 dark:text-purple-400 transform -rotate-90 whitespace-nowrap",children:"Queries (Q)"})}),e.jsx("div",{className:"grid gap-1 ml-4",style:{gridTemplateColumns:`repeat(${a}, 1fr)`,maxWidth:"400px"},children:Array.from({length:a}).map((t,s)=>Array.from({length:a}).map((o,r)=>{const b=C(s,r),p=Math.max(20,Math.min(60,400/a-4));return e.jsx(N.div,{animate:{scale:b==="active"?1.15:1,boxShadow:b==="active"?"0 0 25px rgba(245, 158, 11, 0.6)":"none"},transition:{type:"spring",stiffness:300},style:{width:p,height:p},className:`
                                                        rounded-md border-2 flex items-center justify-center
                                                        text-xs font-mono transition-colors
                                                        ${b==="active"?"border-amber-500 bg-amber-400 text-white":b==="processed"?"border-emerald-400 bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300":"border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-700 text-slate-400"}
                                                    `,children:p>30&&`${s},${r}`},`${s}-${r}`)}))})]})}),e.jsxs("div",{className:"flex justify-center gap-8 mt-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-amber-400 border-2 border-amber-500 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Computing in SRAM"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-emerald-100 dark:bg-emerald-900/40 border-2 border-emerald-400 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-slate-100 dark:bg-slate-700 border-2 border-slate-300 dark:border-slate-600 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Pending"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-slate-100 dark:bg-slate-700/50 rounded-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Processing Progress"}),e.jsxs("span",{className:"font-mono text-amber-600",children:[(i.length/x*100).toFixed(0),"%"]})]}),e.jsx("div",{className:"h-2 bg-slate-200 dark:bg-slate-600 rounded-full overflow-hidden",children:e.jsx(N.div,{className:"h-full bg-gradient-to-r from-amber-500 to-orange-500",animate:{width:`${i.length/x*100}%`}})})]}),e.jsx("div",{className:"mt-6 p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl",children:e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("strong",{className:"text-amber-600",children:"Key Insight:"})," Each tile only needs",e.jsxs("span",{className:"font-mono mx-1",children:[l,"×",l," = ",l*l]}),"elements in SRAM, regardless of total sequence length. This is why Flash Attention scales to long sequences without running out of memory!"]})})]})]})]})})}export{R as default};
