import{r as h,j as e,Z as u,R as v,w,e as F}from"./index-quAWpIA7.js";import{R as C}from"./refresh-cw-BoTFdhd7.js";import{m as p}from"./proxy-D7LjGbFl.js";import{I as L}from"./info-CH9TLaYi.js";import{P as z}from"./plus-C2RRVVSj.js";function j({x:l,y:d,color:a,label:x,maxMagnitude:r=3}){const c=Math.max(-r,Math.min(r,l)),n=Math.max(-r,Math.min(r,d));return e.jsxs("g",{children:[e.jsx(p.line,{x1:0,y1:0,x2:c*60,y2:-n*60,stroke:a,strokeWidth:3,initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.5}}),e.jsx(p.circle,{cx:c*60,cy:-n*60,r:6,fill:a,initial:{scale:0},animate:{scale:1}}),e.jsx("text",{x:c*60+10,y:-n*60,fill:a,fontSize:12,fontWeight:"bold",children:x})]})}function R({layerNum:l,output:d,onOutputChange:a,color:x}){return e.jsxs("div",{className:`p-4 rounded-xl border-2 ${x}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:["Layer ",l," Output"]}),e.jsxs("span",{className:"text-xs text-slate-500 font-mono",children:["f",l,"(x)"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"X component"}),e.jsx("input",{type:"range",min:"-1",max:"1",step:"0.1",value:d[0],onChange:r=>a([parseFloat(r.target.value),d[1]]),className:"w-full"}),e.jsx("div",{className:"text-center font-mono text-sm",children:d[0].toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Y component"}),e.jsx("input",{type:"range",min:"-1",max:"1",step:"0.1",value:d[1],onChange:r=>a([d[0],parseFloat(r.target.value)]),className:"w-full"}),e.jsx("div",{className:"text-center font-mono text-sm",children:d[1].toFixed(1)})]})]})]})}function W(){const[l,d]=h.useState(3),[a,x]=h.useState([1,.5]),[r,o]=h.useState([[.3,.4],[-.2,.5],[.4,-.3],[.1,.2],[-.3,.3]]),n=h.useCallback(()=>{const s=[a];for(let t=0;t<l;t++){const i=s[t],b=r[t];s.push([i[0]+b[0],i[1]+b[1]])}return s},[a,r,l])(),g=(s,t)=>{const i=[...r];i[s]=t,o(i)},f=()=>{x([(Math.random()-.5)*2,(Math.random()-.5)*2]),o(r.map(()=>[(Math.random()-.5)*1.5,(Math.random()-.5)*1.5]))},N=()=>{x([1,.5]),o([[.3,.4],[-.2,.5],[.4,-.3],[.1,.2],[-.3,.3]])},m=["#06b6d4","#8b5cf6","#f59e0b","#10b981","#f43f5e","#6366f1"],y=["border-violet-300 dark:border-violet-700 bg-violet-50 dark:bg-violet-900/20","border-amber-300 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20","border-emerald-300 dark:border-emerald-700 bg-emerald-50 dark:bg-emerald-900/20","border-rose-300 dark:border-rose-700 bg-rose-50 dark:bg-rose-900/20","border-indigo-300 dark:border-indigo-700 bg-indigo-50 dark:bg-indigo-900/20"];return Math.sqrt(n[l][0]**2+n[l][1]**2),e.jsx("div",{className:"p-8 h-full flex flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"max-w-6xl w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-indigo-600 dark:text-indigo-400 mb-4",children:"Interactive Residual Stream"}),e.jsx("p",{className:"text-lg text-slate-700 dark:text-slate-300",children:"Adjust layer outputs and watch how they accumulate in the residual stream"})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-slate-800 px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("label",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Layers:"}),e.jsx("select",{value:l,onChange:s=>d(parseInt(s.target.value)),className:"bg-transparent text-slate-700 dark:text-slate-200 font-medium",children:[1,2,3,4,5].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors",children:[e.jsx(C,{size:18}),"Randomize"]}),e.jsx("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",children:"Reset"})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"text-indigo-500",size:20}),"Vector Space Visualization"]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("svg",{width:"350",height:"350",className:"bg-slate-50 dark:bg-slate-900 rounded-xl",children:e.jsxs("g",{transform:"translate(175, 175)",children:[e.jsx("line",{x1:"-150",y1:"0",x2:"150",y2:"0",stroke:"#94a3b8",strokeWidth:"1"}),e.jsx("line",{x1:"0",y1:"-150",x2:"0",y2:"150",stroke:"#94a3b8",strokeWidth:"1"}),[-2,-1,1,2].map(s=>e.jsxs(v.Fragment,{children:[e.jsx("line",{x1:s*60,y1:"-150",x2:s*60,y2:"150",stroke:"#e2e8f0",strokeWidth:"1",strokeDasharray:"4"}),e.jsx("line",{x1:"-150",y1:-s*60,x2:"150",y2:-s*60,stroke:"#e2e8f0",strokeWidth:"1",strokeDasharray:"4"})]},s)),Array.from({length:l}).map((s,t)=>e.jsx(j,{x:r[t][0],y:r[t][1],color:m[t+1],label:`f${t+1}`},`layer-${t}`)),e.jsx(j,{x:a[0],y:a[1],color:m[0],label:"Input"}),e.jsx(j,{x:n[l][0],y:n[l][1],color:"#22c55e",label:"Final"})]})})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:m[0]}}),e.jsxs("span",{className:"text-slate-600 dark:text-slate-400",children:["Input: [",a[0].toFixed(2),", ",a[1].toFixed(2),"]"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsxs("span",{className:"text-slate-600 dark:text-slate-400",children:["Final: [",n[l][0].toFixed(2),", ",n[l][1].toFixed(2),"]"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-xl border-2 border-cyan-300 dark:border-cyan-700 bg-cyan-50 dark:bg-cyan-900/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"Input Vector"}),e.jsx("span",{className:"text-xs text-slate-500 font-mono",children:"x"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"X component"}),e.jsx("input",{type:"range",min:"-2",max:"2",step:"0.1",value:a[0],onChange:s=>x([parseFloat(s.target.value),a[1]]),className:"w-full"}),e.jsx("div",{className:"text-center font-mono text-sm",children:a[0].toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Y component"}),e.jsx("input",{type:"range",min:"-2",max:"2",step:"0.1",value:a[1],onChange:s=>x([a[0],parseFloat(s.target.value)]),className:"w-full"}),e.jsx("div",{className:"text-center font-mono text-sm",children:a[1].toFixed(1)})]})]})]}),Array.from({length:l}).map((s,t)=>e.jsx(R,{layerNum:t+1,output:r[t],onOutputChange:i=>g(t,i),color:y[t]},t))]})]}),e.jsxs("div",{className:"mt-8 bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"text-green-500",size:20}),"Residual Stream at Each Layer"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-2 px-4 text-slate-600 dark:text-slate-400",children:"Position"}),e.jsx("th",{className:"text-left py-2 px-4 text-slate-600 dark:text-slate-400",children:"Formula"}),e.jsx("th",{className:"text-left py-2 px-4 text-slate-600 dark:text-slate-400",children:"Value"}),e.jsx("th",{className:"text-left py-2 px-4 text-slate-600 dark:text-slate-400",children:"Magnitude"})]})}),e.jsx("tbody",{children:n.map((s,t)=>{const i=Math.sqrt(s[0]**2+s[1]**2);return e.jsxs(p.tr,{className:"border-b border-slate-100 dark:border-slate-700/50",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.1},children:[e.jsx("td",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t===l?"#22c55e":m[t]}}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:t===0?"Input":t===l?"Output":`After Layer ${t}`})]})}),e.jsx("td",{className:"py-2 px-4 font-mono text-xs text-slate-500",children:t===0?"x":`x + ${Array.from({length:t}).map((b,k)=>`f${k+1}`).join(" + ")}`}),e.jsxs("td",{className:"py-2 px-4 font-mono text-slate-600 dark:text-slate-300",children:["[",s[0].toFixed(2),", ",s[1].toFixed(2),"]"]}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-blue-400 to-green-400",style:{width:`${Math.min(100,i*30)}px`}}),e.jsx("span",{className:"font-mono text-xs text-slate-500",children:i.toFixed(2)})]})})]},t)})})]})})]}),e.jsx(p.div,{className:"mt-8 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-2xl p-6 text-white",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(L,{size:28,className:"flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-xl mb-2",children:"What You're Seeing"}),e.jsxs("ul",{className:"space-y-2 text-indigo-100",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(z,{size:16,className:"flex-shrink-0 mt-1"}),e.jsx("span",{children:"Each layer adds a small vector contribution to the residual stream"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(F,{size:16,className:"flex-shrink-0 mt-1"}),e.jsxs("span",{children:["The final output is the sum of the input plus all layer outputs: ",e.jsx("code",{className:"bg-white/20 px-1 rounded",children:"x + f1 + f2 + ... + fn"})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(u,{size:16,className:"flex-shrink-0 mt-1"}),e.jsx("span",{children:"Notice how even small per-layer changes can lead to large accumulated effects. This is how depth enables complex representations!"})]})]})]})]})})]})})}export{W as default};
