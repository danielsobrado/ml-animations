import{r as l,j as e,m as w,e as _}from"./index-quAWpIA7.js";import{P as S}from"./pause-Ch50eX2B.js";import{P as A}from"./play-DgR7o5cW.js";function z(){const[a,m]=l.useState(0),[r,n]=l.useState(!1),[h,N]=l.useState(0),[i,v]=l.useState(!1),p=["[CLS]","The","cat","sat","on","mat"],d=[{title:"Input Embeddings",description:"Each token embedding (768-d) enters the self-attention layer."},{title:"Linear Projections",description:"Project embeddings to Q, K, V matrices. For each head: 768 ‚Üí 64 dimensions."},{title:"Compute Attention Scores",description:"Score = Q √ó K·µÄ / ‚àöd‚Çñ. Each token queries all other tokens to determine relevance."},{title:"Apply Softmax",description:"Softmax normalizes scores to attention weights (sum to 1 for each query token)."},{title:"Weighted Sum of Values",description:"Output = attention_weights √ó V. Aggregate information based on relevance."},{title:"Concatenate Heads",description:"Concat all 12 heads (12 √ó 64 = 768), then project with W·¥º back to 768-d."}],c=[{name:"Position",description:"Attends to nearby tokens",pattern:(s,t)=>1-Math.abs(s-t)*.2},{name:"[CLS] Focus",description:"All tokens attend to [CLS]",pattern:(s,t)=>t===0?.8:.1},{name:"Syntax",description:"Subject-verb relationships",pattern:(s,t)=>s===1&&t===3||s===3&&t===1?.9:.15},{name:"Self",description:"Token attends to itself",pattern:(s,t)=>s===t?.7:.15}];l.useEffect(()=>{if(r){const s=setInterval(()=>{m(t=>t>=d.length-1?(n(!1),t):t+1)},3e3);return()=>clearInterval(s)}},[r]);const k=()=>{m(0),n(!1)},b=({pattern:s,title:t,size:g="large"})=>{const o=g==="large"?"w-10 h-10":"w-6 h-6",j=g==="large"?"text-xs":"text-[8px]";return e.jsxs("div",{className:"inline-block",children:[t&&e.jsx("p",{className:"text-xs text-gray-800 dark:text-gray-400 mb-1 text-center",children:t}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:`${o}`}),p.map((y,x)=>e.jsx("div",{className:`${o} ${j} flex items-center justify-center text-gray-700 dark:text-gray-500 font-mono`,children:y.slice(0,3)},x))]}),p.map((y,x)=>e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:`${o} ${j} flex items-center justify-center text-gray-700 dark:text-gray-500 font-mono`,children:y.slice(0,3)}),p.map((L,f)=>{const u=s(x,f);return e.jsx("div",{className:`${o} flex items-center justify-center ${j} rounded-sm m-0.5`,style:{backgroundColor:`rgba(234, 179, 8, ${u})`,color:u>.5?"black":"white"},children:g==="large"?u.toFixed(2):""},f)})]},x))]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-2",children:["Multi-Head Self-Attention in ",e.jsx("span",{className:"text-yellow-400",children:"BERT"})]}),e.jsx("p",{className:"text-gray-800 dark:text-gray-400",children:"12 attention heads (BERT-Base) learn different types of relationships"})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsxs("button",{onClick:()=>n(!r),className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg transition-colors",children:[r?e.jsx(S,{size:18}):e.jsx(A,{size:18}),r?"Pause":"Play Animation"]}),e.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors",children:[e.jsx(w,{size:18}),"Reset"]}),e.jsxs("button",{onClick:()=>v(!i),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${i?"bg-purple-600":"bg-white/10 hover:bg-white/20"}`,children:[e.jsx(_,{size:18}),i?"Single Head":"All Heads"]})]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:d.map((s,t)=>e.jsxs("button",{onClick:()=>{m(t),n(!1)},className:`px-3 py-1 rounded-full text-sm transition-all ${t===a?"bg-yellow-500 text-black":t<a?"bg-yellow-900 text-yellow-300":"bg-white/10 text-gray-700 dark:text-gray-500"}`,children:[t+1,". ",s.title]},t))}),e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-500/30 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-bold text-yellow-400",children:["Step ",a+1,": ",d[a].title]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mt-1",children:d[a].description})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-6 border border-white/10 overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8 min-w-max",children:[e.jsx("div",{className:`text-center transition-all duration-500 ${a>=0?"opacity-100":"opacity-30"}`,children:e.jsxs("div",{className:"bg-blue-600/30 border border-blue-500 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-medium text-blue-300",children:"Input"}),e.jsx("p",{className:"text-xs text-gray-800 dark:text-gray-400",children:"[6, 768]"})]})}),e.jsx("span",{className:"text-gray-700 dark:text-gray-500",children:"‚Üí"}),e.jsxs("div",{className:`text-center transition-all duration-500 ${a>=1?"opacity-100":"opacity-30"}`,children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-red-600/30 border border-red-500 rounded-lg p-2",children:e.jsx("p",{className:"text-xs text-red-300",children:"Q"})}),e.jsx("div",{className:"bg-green-600/30 border border-green-500 rounded-lg p-2",children:e.jsx("p",{className:"text-xs text-green-300",children:"K"})}),e.jsx("div",{className:"bg-purple-600/30 border border-purple-500 rounded-lg p-2",children:e.jsx("p",{className:"text-xs text-purple-300",children:"V"})})]}),e.jsx("p",{className:"text-xs text-gray-800 dark:text-gray-400 mt-1",children:"[6, 12, 64]"})]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-500",children:"‚Üí"}),e.jsx("div",{className:`text-center transition-all duration-500 ${a>=2?"opacity-100":"opacity-30"}`,children:e.jsxs("div",{className:"bg-orange-600/30 border border-orange-500 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-medium text-orange-300",children:"Q√óK·µÄ/‚àö64"}),e.jsx("p",{className:"text-xs text-gray-800 dark:text-gray-400",children:"[6, 6]"})]})}),e.jsx("span",{className:"text-gray-700 dark:text-gray-500",children:"‚Üí"}),e.jsx("div",{className:`text-center transition-all duration-500 ${a>=3?"opacity-100":"opacity-30"}`,children:e.jsxs("div",{className:"bg-yellow-600/30 border border-yellow-500 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-300",children:"Softmax"}),e.jsx("p",{className:"text-xs text-gray-800 dark:text-gray-400",children:"weights"})]})}),e.jsx("span",{className:"text-gray-700 dark:text-gray-500",children:"‚Üí"}),e.jsx("div",{className:`text-center transition-all duration-500 ${a>=4?"opacity-100":"opacity-30"}`,children:e.jsxs("div",{className:"bg-teal-600/30 border border-teal-500 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-medium text-teal-300",children:"Attn √ó V"}),e.jsx("p",{className:"text-xs text-gray-800 dark:text-gray-400",children:"[6, 64]"})]})}),e.jsx("span",{className:"text-gray-700 dark:text-gray-500",children:"‚Üí"}),e.jsx("div",{className:`text-center transition-all duration-500 ${a>=5?"opacity-100":"opacity-30"}`,children:e.jsxs("div",{className:"bg-pink-600/30 border border-pink-500 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-medium text-pink-300",children:"Concat + W·¥º"}),e.jsx("p",{className:"text-xs text-gray-800 dark:text-gray-400",children:"[6, 768]"})]})})]}),a>=2&&e.jsx("div",{className:"mt-6",children:i?e.jsxs("div",{children:[e.jsx("h4",{className:"text-center text-gray-800 dark:text-gray-400 mb-4",children:"All 12 Attention Heads (showing 4 representative patterns)"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 justify-items-center",children:c.map((s,t)=>e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-yellow-400 mb-1",children:["Head ",t+1,": ",s.name]}),e.jsx(b,{pattern:s.pattern,size:"small"}),e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-500 mt-1",children:s.description})]},t))})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:c.map((s,t)=>e.jsx("button",{onClick:()=>N(t),className:`px-3 py-1 rounded text-sm transition-all ${h===t?"bg-yellow-500 text-black":"bg-white/10 hover:bg-white/20"}`,children:s.name},t))}),e.jsx(b,{pattern:c[h].pattern,title:`Attention Pattern: ${c[h].description}`})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-black/30 rounded-xl p-4 border border-white/10",children:[e.jsx("h4",{className:"font-bold text-yellow-400 mb-3",children:"üß† Why Multiple Heads?"}),e.jsxs("ul",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-2",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-green-400",children:"‚úì"}),e.jsx("span",{children:"Different heads learn different patterns (syntax, semantics, position)"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-green-400",children:"‚úì"}),e.jsx("span",{children:"Parallel computation - all heads process simultaneously"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-green-400",children:"‚úì"}),e.jsx("span",{children:"Low-rank approximation: 12 √ó 64 = 768, but more expressive"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-green-400",children:"‚úì"}),e.jsx("span",{children:"Redundancy provides robustness"})]})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-xl p-4 border border-white/10",children:[e.jsx("h4",{className:"font-bold text-purple-600 dark:text-purple-400 mb-3",children:"üìä BERT Attention Stats"}),e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"py-2 text-gray-800 dark:text-gray-400",children:"Number of heads"}),e.jsx("td",{className:"py-2 text-right font-mono",children:"12 (Base) / 16 (Large)"})]}),e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"py-2 text-gray-800 dark:text-gray-400",children:"Head dimension (d‚Çñ)"}),e.jsx("td",{className:"py-2 text-right font-mono",children:"64"})]}),e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"py-2 text-gray-800 dark:text-gray-400",children:"Total dimension"}),e.jsx("td",{className:"py-2 text-right font-mono",children:"768 (Base) / 1024 (Large)"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 text-gray-800 dark:text-gray-400",children:"Attention layers"}),e.jsx("td",{className:"py-2 text-right font-mono",children:"12 (Base) / 24 (Large)"})]})]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-900/30 to-green-900/30 rounded-xl p-4 border border-blue-500/30",children:[e.jsx("h4",{className:"font-bold text-blue-600 dark:text-blue-400 mb-3",children:"üîÑ Bidirectional Attention (BERT's Key Innovation)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"GPT (Unidirectional):"}),e.jsx("div",{className:"flex gap-1",children:["The","cat","sat","on"].map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"px-2 py-1 bg-gray-700 rounded text-xs",children:s}),e.jsxs("div",{className:"text-xs text-gray-700 dark:text-gray-500 mt-1",children:["sees: ",["The","cat","sat","on"].slice(0,t+1).join(", ")]})]},t))}),e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-500 mt-2",children:"Each token only sees tokens to its left"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"BERT (Bidirectional):"}),e.jsx("div",{className:"flex gap-1",children:["The","cat","sat","on"].map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"px-2 py-1 bg-yellow-700 rounded text-xs",children:s}),e.jsx("div",{className:"text-xs text-yellow-500 mt-1",children:"sees: all tokens"})]},t))}),e.jsx("p",{className:"text-xs text-yellow-500 mt-2",children:"Each token sees ALL other tokens (full context)"})]})]})]}),e.jsxs("div",{className:"bg-black/40 rounded-xl p-4 border border-white/10",children:[e.jsx("p",{className:"text-sm text-gray-800 dark:text-gray-400 mb-3",children:"üêç PyTorch Multi-Head Attention:"}),e.jsx("pre",{className:"text-sm overflow-x-auto",children:e.jsx("code",{className:"text-green-300",children:`class MultiHeadAttention(nn.Module):
    def __init__(self, hidden_size=768, num_heads=12):
        super().__init__()
        self.num_heads = num_heads
        self.head_dim = hidden_size // num_heads  # 64
        
        # Q, K, V projections
        self.query = nn.Linear(hidden_size, hidden_size)
        self.key = nn.Linear(hidden_size, hidden_size)
        self.value = nn.Linear(hidden_size, hidden_size)
        # Output projection
        self.out = nn.Linear(hidden_size, hidden_size)
        
    def forward(self, x, attention_mask=None):
        B, L, _ = x.shape  # batch, length, hidden_size
        
        # Project to Q, K, V
        Q = self.query(x).view(B, L, self.num_heads, self.head_dim).transpose(1, 2)
        K = self.key(x).view(B, L, self.num_heads, self.head_dim).transpose(1, 2)
        V = self.value(x).view(B, L, self.num_heads, self.head_dim).transpose(1, 2)
        # Shape: [B, num_heads, L, head_dim]
        
        # Attention scores
        scores = torch.matmul(Q, K.transpose(-2, -1)) / math.sqrt(self.head_dim)
        
        # Apply mask (for padding)
        if attention_mask is not None:
            scores = scores.masked_fill(attention_mask == 0, -1e9)
        
        # Softmax and weighted sum
        attn_weights = F.softmax(scores, dim=-1)
        context = torch.matmul(attn_weights, V)  # [B, num_heads, L, head_dim]
        
        # Concatenate heads and project
        context = context.transpose(1, 2).contiguous().view(B, L, -1)
        return self.out(context)  # [B, L, 768]`})})]})]})}export{z as default};
