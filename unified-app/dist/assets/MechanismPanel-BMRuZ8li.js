import{r as u,j as e,m as L,z as S,y as p,e as w}from"./index-quAWpIA7.js";import{P as T}from"./pause-Ch50eX2B.js";import{P as M}from"./play-DgR7o5cW.js";import{m as a}from"./proxy-D7LjGbFl.js";import{P as F}from"./plus-C2RRVVSj.js";import{S as z}from"./scale-DPnfMsVY.js";function o({values:t,label:c,color:i,scale:m=1,showNorm:j=!1}){const N=Math.sqrt(t.reduce((n,s)=>n+s*s,0)),h=Math.max(...t.map(Math.abs))||1;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-mono w-16 text-right text-slate-600 dark:text-slate-400",children:c}),e.jsx("div",{className:"flex gap-1",children:t.map((n,s)=>e.jsx(a.div,{className:"w-8 h-8 rounded flex items-center justify-center text-xs font-mono text-white",style:{backgroundColor:i,opacity:.4+Math.abs(n)/h*.6},initial:{scale:.8,opacity:0},animate:{scale:m,opacity:1},transition:{delay:s*.05},children:n.toFixed(1)},s))}),j&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono",children:["||v|| = ",N.toFixed(2)]})]})}function B(){const[t,c]=u.useState(0),[i,m]=u.useState(!1),[j,N]=u.useState(0),h=[.5,-.3,.8,-.2],n=[[.2,.4,-.1,.3],[-.1,.2,.3,-.1]],s=[{id:"input",title:"Input Token Vector",description:"The token embedding enters the residual stream"},{id:"attention",title:"Attention Layer",description:"Self-attention computes relationships and produces an update vector"},{id:"add-attention",title:"Residual Addition #1",description:"The attention output is ADDED to the stream (not replaced!)"},{id:"layernorm1",title:"Layer Normalization",description:"LayerNorm rescales the vector to unit norm, preserving direction"},{id:"ffn",title:"Feed-Forward Network",description:"MLP processes each position independently"},{id:"add-ffn",title:"Residual Addition #2",description:"FFN output is added to the stream"},{id:"layernorm2",title:"Final Layer Normalization",description:"Ready for the next transformer block!"}],A=()=>{let r=[...h],l=n[0],x=n[1];const b=r.map((g,f)=>g+l[f]),v=y(b),k=v.map((g,f)=>g+x[f]),R=y(k);return{initial:r,attnOutput:l,afterAttn:b,normAfterAttn:v,ffnOutput:x,afterFFN:k,normAfterFFN:R}},y=r=>{const l=Math.sqrt(r.reduce((x,b)=>x+b*b,0));return r.map(x=>x/l)},d=A();u.useEffect(()=>{if(i){const r=setTimeout(()=>{t<s.length-1?c(t+1):m(!1)},2e3);return()=>clearTimeout(r)}},[i,t]);const P=()=>{c(0),m(!1)};return e.jsx("div",{className:"p-8 h-full flex flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"max-w-5xl w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400 mb-4",children:"Vector Flow Through a Transformer Block"}),e.jsx("p",{className:"text-lg text-slate-700 dark:text-slate-300",children:"Watch how vectors flow and accumulate through residual connections"})]}),e.jsxs("div",{className:"flex justify-center gap-4 mb-8",children:[e.jsxs("button",{onClick:()=>m(!i),className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[i?e.jsx(T,{size:18}):e.jsx(M,{size:18}),i?"Pause":"Play"]}),e.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",children:[e.jsx(L,{size:18}),"Reset"]}),e.jsxs("button",{onClick:()=>t<s.length-1&&c(t+1),disabled:t>=s.length-1,className:"flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors disabled:opacity-50",children:["Next Step",e.jsx(S,{size:18})]})]}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"flex gap-2",children:s.map((r,l)=>e.jsx("button",{onClick:()=>c(l),className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-all ${l===t?"bg-blue-500 text-white scale-110":l<t?"bg-blue-200 dark:bg-blue-800 text-blue-700 dark:text-blue-300":"bg-slate-200 dark:bg-slate-700 text-slate-500"}`,children:l+1},r.id))})}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 mb-8",children:[e.jsxs("h3",{className:"font-bold text-blue-700 dark:text-blue-300 text-lg mb-1",children:["Step ",t+1,": ",s[t].title]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:s[t].description})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"flex flex-col gap-6",children:e.jsxs("div",{className:"relative",children:[e.jsxs(a.div,{className:`p-4 rounded-xl border-2 ${t===0?"border-cyan-500 bg-cyan-50 dark:bg-cyan-900/20":"border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900/50"}`,animate:{scale:t===0?1.02:1},children:[e.jsx("div",{className:"text-sm font-semibold text-cyan-700 dark:text-cyan-300 mb-2",children:"Residual Stream (Input)"}),e.jsx(o,{values:d.initial,label:"x",color:"#06b6d4",showNorm:!0})]}),e.jsx("div",{className:"flex justify-center my-4",children:e.jsx(p,{className:"text-slate-400 rotate-90",size:24})}),e.jsxs(a.div,{className:`p-4 rounded-xl border-2 ${t===1||t===2?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900/50"}`,animate:{scale:t===1||t===2?1.02:1},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(w,{className:"text-purple-500",size:20}),e.jsx("div",{className:"text-sm font-semibold text-purple-700 dark:text-purple-300",children:"Self-Attention"})]}),t>=1&&e.jsx(a.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:e.jsx(o,{values:d.attnOutput,label:"Attn(x)",color:"#a855f7"})}),t>=2&&e.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(F,{className:"text-emerald-500",size:16}),e.jsx("span",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-300",children:"Residual Addition: x + Attn(x)"})]}),e.jsx(o,{values:d.afterAttn,label:"x + Attn",color:"#10b981",showNorm:!0})]})]}),t>=3&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center my-4",children:e.jsx(p,{className:"text-slate-400 rotate-90",size:24})}),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`p-4 rounded-xl border-2 ${t===3?"border-amber-500 bg-amber-50 dark:bg-amber-900/20":"border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(z,{className:"text-amber-500",size:20}),e.jsx("div",{className:"text-sm font-semibold text-amber-700 dark:text-amber-300",children:"Layer Normalization"})]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-2",children:"Rescales to unit norm while preserving direction"}),e.jsx(o,{values:d.normAfterAttn,label:"LN(x)",color:"#f59e0b",showNorm:!0})]})]}),t>=4&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center my-4",children:e.jsx(p,{className:"text-slate-400 rotate-90",size:24})}),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`p-4 rounded-xl border-2 ${t===4||t===5?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(w,{className:"text-orange-500",size:20}),e.jsx("div",{className:"text-sm font-semibold text-orange-700 dark:text-orange-300",children:"Feed-Forward Network (MLP)"})]}),e.jsx(o,{values:d.ffnOutput,label:"FFN(x)",color:"#f97316"}),t>=5&&e.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(F,{className:"text-emerald-500",size:16}),e.jsx("span",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-300",children:"Residual Addition: x + FFN(x)"})]}),e.jsx(o,{values:d.afterFFN,label:"x + FFN",color:"#10b981",showNorm:!0})]})]})]}),t>=6&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center my-4",children:e.jsx(p,{className:"text-slate-400 rotate-90",size:24})}),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 rounded-xl border-2 border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(z,{className:"text-indigo-500",size:20}),e.jsx("div",{className:"text-sm font-semibold text-indigo-700 dark:text-indigo-300",children:"Output (Ready for Next Block)"})]}),e.jsx(o,{values:d.normAfterFFN,label:"Output",color:"#6366f1",showNorm:!0})]})]})]})})}),e.jsxs(a.div,{className:"mt-8 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-2xl p-6 text-white",initial:{opacity:0},animate:{opacity:1},children:[e.jsx("h4",{className:"font-bold text-xl mb-3",children:'The Mathematics of "Add"'}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"font-mono text-lg mb-2",children:["x",e.jsx("sub",{children:"new"})," = x + f(x)"]}),e.jsx("p",{className:"text-sm text-blue-100",children:"Vector addition means the original information (x) is always preserved. The layer can only add new features, never remove old ones."})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[e.jsx("div",{className:"font-mono text-lg mb-2",children:"LayerNorm(x) = x / ||x||"}),e.jsx("p",{className:"text-sm text-blue-100",children:"Normalization keeps vectors at consistent scale without changing their direction. This stabilizes training in very deep networks."})]})]})]})]})})}export{B as default};
