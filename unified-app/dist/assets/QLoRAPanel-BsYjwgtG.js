import{r as n,j as e,m as x,R as h,y as o,Z as p,L as u}from"./index-quAWpIA7.js";import{P as g}from"./pause-Ch50eX2B.js";import{P as b}from"./play-DgR7o5cW.js";import{C as f}from"./check-circle-2-D_aIm6E6.js";import{A as j}from"./arrow-down-B9RWJrDO.js";function L(){const[s,i]=n.useState(0),[r,d]=n.useState(!1),l=[{title:"Step 1: Load Model in 4-bit",desc:"Quantize the pretrained weights from FP16/BF16 to 4-bit (NF4) format",detail:"Reduces memory from ~14GB to ~3.5GB for a 7B model!"},{title:"Step 2: Add LoRA Adapters",desc:"Attach low-rank adapter matrices to the quantized model",detail:"LoRA adapters remain in higher precision (FP16/BF16)"},{title:"Step 3: Train Only LoRA",desc:"Compute gradients only for the small LoRA matrices",detail:"Gradients use double quantization for memory efficiency"},{title:"Step 4: Inference",desc:"Use quantized base + trained LoRA for predictions",detail:"Can also merge LoRA into quantized weights"}];n.useEffect(()=>{if(r&&s<l.length-1){const a=setTimeout(()=>i(t=>t+1),3e3);return()=>clearTimeout(a)}else s>=l.length-1&&d(!1)},[r,s]);const m=()=>{i(0),d(!1)},c=[{method:"Full FP32",memory:28,color:"bg-red-500"},{method:"Full FP16",memory:14,color:"bg-orange-500"},{method:"LoRA FP16",memory:10,color:"bg-yellow-500"},{method:"QLoRA 8-bit",memory:6,color:"bg-blue-500"},{method:"QLoRA 4-bit",memory:3.5,color:"bg-green-500"}];return e.jsxs("div",{className:"p-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-purple-900 mb-2",children:"QLoRA: Quantized LoRA"}),e.jsx("p",{className:"text-slate-800 dark:text-slate-600",children:"Combine 4-bit quantization with LoRA for extreme memory efficiency"})]}),e.jsxs("div",{className:"flex justify-center gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>d(!r),className:"flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600",children:[r?e.jsx(g,{size:18}):e.jsx(b,{size:18}),r?"Pause":"Play"]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300",children:[e.jsx(x,{size:18}),"Reset"]})]}),e.jsx("div",{className:"flex justify-between items-center mb-8 px-4",children:l.map((a,t)=>e.jsxs(h.Fragment,{children:[e.jsxs("div",{className:`flex flex-col items-center cursor-pointer transition-all ${t<=s?"opacity-100":"opacity-40"}`,onClick:()=>i(t),children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center mb-2 transition-all ${t<s?"bg-green-500 text-white":t===s?"bg-purple-500 text-white animate-pulse":"bg-slate-200"}`,children:t<s?e.jsx(f,{size:20}):t+1}),e.jsx("span",{className:"text-xs font-medium text-center max-w-24",children:a.title.split(": ")[1]})]}),t<l.length-1&&e.jsx("div",{className:`flex-1 h-1 mx-2 rounded ${t<s?"bg-green-500":"bg-slate-200"}`})]},t))}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border shadow-sm",children:[e.jsx("h3",{className:"font-bold text-purple-800 mb-4",children:l[s].title}),e.jsxs("div",{className:"min-h-48 flex items-center justify-center",children:[s===0&&e.jsxs("div",{className:"text-center animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-100 p-4 rounded-lg border-2 border-blue-300",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"FP16 Weights"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"14 GB"})]}),e.jsx(o,{className:"text-slate-800 dark:text-slate-400",size:32}),e.jsxs("div",{className:"bg-green-100 p-4 rounded-lg border-2 border-green-300",children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"4-bit (NF4)"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"3.5 GB"})]})]}),e.jsx("div",{className:"text-sm text-slate-800 dark:text-slate-600",children:"NF4 = NormalFloat 4-bit (optimal for normally distributed weights)"})]}),s===1&&e.jsx("div",{className:"animate-fadeIn",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-green-100 rounded-lg p-6 border-2 border-green-300",children:[e.jsx("div",{className:"text-center font-medium text-green-800 mb-2",children:"4-bit Base Model"}),e.jsx("div",{className:"grid grid-cols-4 gap-1",children:Array.from({length:16}).map((a,t)=>e.jsx("div",{className:"w-8 h-8 bg-green-300 rounded"},t))})]}),e.jsxs("div",{className:"absolute -right-4 top-1/2 -translate-y-1/2 flex flex-col gap-2",children:[e.jsx("div",{className:"bg-purple-400 text-white px-2 py-1 rounded text-xs",children:"LoRA A"}),e.jsx("div",{className:"bg-orange-400 text-white px-2 py-1 rounded text-xs",children:"LoRA B"})]})]})}),s===2&&e.jsxs("div",{className:"animate-fadeIn space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-slate-100 p-3 rounded-lg flex-1",children:[e.jsx("div",{className:"text-xs text-slate-700 dark:text-slate-500 mb-1",children:"Forward Pass"}),e.jsx(o,{className:"text-green-500 mx-auto"})]}),e.jsxs("div",{className:"bg-slate-100 p-3 rounded-lg flex-1",children:[e.jsx("div",{className:"text-xs text-slate-700 dark:text-slate-500 mb-1",children:"Compute Loss"}),e.jsx("div",{className:"text-2xl text-center",children:"üìä"})]}),e.jsxs("div",{className:"bg-purple-100 p-3 rounded-lg flex-1 border-2 border-purple-300",children:[e.jsx("div",{className:"text-xs text-purple-600 mb-1",children:"Update LoRA"}),e.jsx(j,{className:"text-purple-500 mx-auto"})]})]}),e.jsx("div",{className:"text-center text-sm text-slate-800 dark:text-slate-600",children:"Base model weights stay frozen & quantized"})]}),s===3&&e.jsxs("div",{className:"animate-fadeIn text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üöÄ"}),e.jsx("div",{className:"text-lg font-medium text-green-700 mb-2",children:"Ready for Inference!"}),e.jsx("div",{className:"text-sm text-slate-800 dark:text-slate-600",children:"~4GB total memory for a fine-tuned 7B model"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-slate-50 rounded-lg text-sm text-slate-700",children:l[s].detail})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border shadow-sm",children:[e.jsx("h3",{className:"font-bold text-slate-800 mb-4",children:"Memory Comparison (7B Model)"}),e.jsx("div",{className:"space-y-3",children:c.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 text-sm text-slate-800 dark:text-slate-600",children:a.method}),e.jsx("div",{className:"flex-1 bg-slate-100 rounded-full h-6 overflow-hidden",children:e.jsx("div",{className:`${a.color} h-full rounded-full transition-all duration-500 flex items-center justify-end pr-2`,style:{width:`${a.memory/28*100}%`},children:e.jsxs("span",{className:"text-xs text-white font-medium",children:[a.memory," GB"]})})})]},t))}),e.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(p,{size:18}),e.jsx("span",{className:"font-medium",children:"QLoRA enables fine-tuning on consumer GPUs!"})]})})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 mb-6",children:[e.jsx("h3",{className:"font-bold text-white mb-4 text-center",children:"QLoRA Key Innovations"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-purple-600 dark:text-purple-400 font-bold mb-2",children:"4-bit NormalFloat"}),e.jsx("p",{className:"text-slate-700 dark:text-sm",children:"Information-theoretically optimal data type for normally distributed weights"})]}),e.jsxs("div",{className:"bg-slate-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-orange-600 dark:text-orange-400 font-bold mb-2",children:"Double Quantization"}),e.jsx("p",{className:"text-slate-700 dark:text-sm",children:"Quantize the quantization constants to save additional memory"})]}),e.jsxs("div",{className:"bg-slate-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-green-400 font-bold mb-2",children:"Paged Optimizers"}),e.jsx("p",{className:"text-slate-700 dark:text-sm",children:"Use NVIDIA unified memory to avoid OOM during gradient checkpointing"})]})]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-6 border border-purple-200 mb-6",children:[e.jsx("h4",{className:"font-bold text-purple-900 mb-3",children:"üîß Quick Start Example"}),e.jsx("pre",{className:"bg-slate-900 text-green-400 p-4 rounded-lg text-sm overflow-x-auto",children:`from transformers import AutoModelForCausalLM, BitsAndBytesConfig
from peft import LoraConfig, get_peft_model

# 4-bit quantization config
bnb_config = BitsAndBytesConfig(
    load_in_4bit=True,
    bnb_4bit_quant_type="nf4",
    bnb_4bit_compute_dtype=torch.bfloat16
)

# Load quantized model
model = AutoModelForCausalLM.from_pretrained(
    "meta-llama/Llama-2-7b",
    quantization_config=bnb_config
)

# Add LoRA adapters
lora_config = LoraConfig(r=8, lora_alpha=16, target_modules=["q_proj", "v_proj"])
model = get_peft_model(model, lora_config)`})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-xl border border-amber-200",children:[e.jsxs("h4",{className:"font-bold text-amber-900 mb-2 flex items-center gap-2",children:[e.jsx(u,{size:18}),"When to Use QLoRA"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-amber-800",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-700",children:"‚úÖ Good for:"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1",children:[e.jsx("li",{children:"Limited GPU memory (12-24 GB)"}),e.jsx("li",{children:"Fine-tuning large models (7B-70B)"}),e.jsx("li",{children:"Rapid experimentation"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-red-700",children:"‚ö†Ô∏è Consider alternatives:"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1",children:[e.jsx("li",{children:"When you need maximum accuracy"}),e.jsx("li",{children:"Production inference (may want full precision)"}),e.jsx("li",{children:"When you have abundant compute"})]})]})]})]})]}),e.jsx("style",{jsx:!0,children:`
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .animate-fadeIn {
                    animation: fadeIn 0.4s ease-out forwards;
                }
            `})]})}export{L as default};
