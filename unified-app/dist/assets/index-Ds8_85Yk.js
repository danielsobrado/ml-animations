import{r as u,j as e}from"./index-CsxpOLHd.js";import{S as re,C as ie,O as ce,W as de,P as Q,M as U,a as Z,L as _,E as ee,b as te,G as ue,e as se,f as xe,g as me}from"./three.module-CNl0Zq82.js";import{g as ne}from"./index-C8pce-KX.js";const v={input:6003669,window:16760832,maxHighlight:15680580,output:7384391,bg:16777215};function he({inputMatrix:l,poolSize:t,stride:x,onComplete:m}){const c=u.useRef(null),P=u.useRef(null),N=u.useRef(null),C=u.useRef({}),[f,E]=u.useState(!1),[L,I]=u.useState({row:0,col:0});u.useEffect(()=>{if(!c.current)return;const p=c.current.clientWidth,w=500,a=new re;a.background=new ie(v.bg),N.current=a;const r=new ce(p/-2,p/2,w/2,w/-2,.1,1e3);r.position.z=100;const h=new de({antialias:!0});h.setSize(p,w),c.current.appendChild(h.domElement),P.current=h;const d=50,b=5,k=(o,n,i,B)=>{const g=new ue,M=new Q(d,d),$=new U({color:B,transparent:!0,opacity:.8}),F=new Z(M,$);g.add(F);const oe=new _(new ee(M),new te({color:3355443,linewidth:2}));g.add(oe);const q=document.createElement("canvas");q.width=128,q.height=128;const D=q.getContext("2d");D.fillStyle="white",D.font="bold 64px Arial",D.textAlign="center",D.textBaseline="middle",D.fillText(o.toString(),64,64);const le=new se(q),ae=new xe({map:le,transparent:!0}),K=new me(ae);return K.scale.set(d*.8,d*.8,1),g.add(K),g.position.set(n,i,0),g.userData={value:o,mesh:F,material:$},a.add(g),g},V=l.length,z=[],S=-200,j=100;l.forEach((o,n)=>{const i=[];o.forEach((B,g)=>{const M=S+g*(d+b),$=j-n*(d+b),F=k(B,M,$,v.input);i.push(F)}),z.push(i)});const y=new Q(t*d+(t-1)*b,t*d+(t-1)*b),J=new U({color:v.window,transparent:!0,opacity:.3}),A=new Z(y,J),G=new _(new ee(y),new te({color:v.window,linewidth:4}));A.add(G),A.visible=!1,a.add(A);const H=Math.floor((V-t)/x)+1,O=[],W=100,X=100;for(let o=0;o<H;o++){const n=[];for(let i=0;i<H;i++){const B=W+i*(d+b),g=X-o*(d+b),M=k(0,B,g,v.output);M.visible=!1,n.push(M)}O.push(n)}C.current={inputCells:z,outputCells:O,window:A,cellSize:d,gap:b,startX:S,startY:j};let Y;const R=()=>{Y=requestAnimationFrame(R),h.render(a,r)};return R(),()=>{var o;cancelAnimationFrame(Y),h.dispose(),(o=c.current)!=null&&o.contains(h.domElement)&&c.current.removeChild(h.domElement)}},[l,t,x]);const T=async()=>{if(f)return;E(!0);const{inputCells:p,outputCells:w,window:a,cellSize:r,gap:h,startX:d,startY:b}=C.current,k=l.length,V=Math.floor((k-t)/x)+1;a.visible=!0;let z=0,S=0;for(let j=0;j<=k-t;j+=x)for(let y=0;y<=k-t;y+=x){I({row:j,col:y});const J=d+y*(r+h)+(t*r+(t-1)*h)/2-r/2,A=b-j*(r+h)-(t*r+(t-1)*h)/2+r/2;await new Promise(n=>{ne.to(a.position,{x:J,y:A,duration:.3,ease:"power2.inOut",onComplete:n})});let G=-1/0,H=-1,O=-1;for(let n=j;n<j+t;n++)for(let i=y;i<y+t;i++)l[n][i]>G&&(G=l[n][i],H=n,O=i);const W=p[H][O];W.userData.material.color.getHex(),await new Promise(n=>{ne.to(W.userData.material.color,{r:(v.maxHighlight>>16&255)/255,g:(v.maxHighlight>>8&255)/255,b:(v.maxHighlight&255)/255,duration:.3,yoyo:!0,repeat:1,onComplete:n})});const X=w[z][S];X.visible=!0;const Y=X.children[2],R=document.createElement("canvas");R.width=128,R.height=128;const o=R.getContext("2d");o.fillStyle="white",o.font="bold 64px Arial",o.textAlign="center",o.textBaseline="middle",o.fillText(G.toString(),64,64),Y.material.map=new se(R),await new Promise(n=>setTimeout(n,300)),S++,S>=V&&(S=0,z++)}a.visible=!1,E(!1),m&&m()},s=()=>{if(f)return;const{outputCells:p,window:w}=C.current;p.forEach(a=>{a.forEach(r=>{r.visible=!1})}),w.visible=!1,I({row:0,col:0})};return e.jsxs("div",{className:"flex flex-col items-center p-3",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Max Pooling Animation"}),e.jsx("div",{ref:c,className:"w-full rounded-lg overflow-hidden shadow-lg bg-white"}),e.jsx("div",{className:"mt-2 p-2 bg-white rounded-lg w-full text-center shadow",children:e.jsx("p",{className:"text-sm text-gray-800",children:f?`Processing window at position (${L.row}, ${L.col})`:"Click Run to start pooling"})}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:T,disabled:f,className:"px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:f?"Running...":"â–¶ Run"}),e.jsx("button",{onClick:s,disabled:f,className:"px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors text-sm",children:"â†º Reset"})]})]})}function ge({onParamsChange:l}){const[t,x]=u.useState(2),[m,c]=u.useState(2),P=()=>{const p=[];for(let w=0;w<4;w++){const a=[];for(let r=0;r<4;r++)a.push(Math.floor(Math.random()*10));p.push(a)}return p},[N,C]=u.useState(P()),f=s=>{x(parseInt(s)),l&&l(N,parseInt(s),m)},E=s=>{c(parseInt(s)),l&&l(N,t,parseInt(s))},L=()=>{const s=P();C(s),l&&l(s,t,m)},I=N.length,T=Math.floor((I-t)/m)+1;return e.jsxs("div",{className:"flex flex-col items-center p-4 h-full",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Configuration"}),e.jsxs("div",{className:"flex flex-col gap-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"font-bold text-gray-700",children:"Pool Size:"}),e.jsx("div",{className:"flex gap-2",children:[2,3].map(s=>e.jsxs("button",{onClick:()=>f(s),className:`px-4 py-2 rounded-lg font-bold transition-colors ${t===s?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[s,"Ã—",s]},s))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"font-bold text-gray-700",children:"Stride:"}),e.jsx("div",{className:"flex gap-2",children:[1,2].map(s=>e.jsx("button",{onClick:()=>E(s),className:`px-4 py-2 rounded-lg font-bold transition-colors ${m===s?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:s},s))})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-sm font-bold text-gray-700 mb-2",children:"Dimensions:"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Input: ",e.jsxs("span",{className:"font-mono font-bold",children:[I,"Ã—",I]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Output: ",e.jsxs("span",{className:"font-mono font-bold",children:[T,"Ã—",T]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formula: (Input - Pool) / Stride + 1"})]}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition-colors",children:"ðŸŽ² Randomize Input"}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200 text-sm text-gray-700 space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"How Max Pooling Works:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Slide window across input"}),e.jsx("li",{children:"Take maximum value in each window"}),e.jsx("li",{children:"Downsamples feature maps (reduces size)"}),e.jsx("li",{children:"Preserves strongest features"})]})]})]})]})}const fe=()=>{const t=[];for(let x=0;x<4;x++){const m=[];for(let c=0;c<4;c++)m.push(Math.floor(Math.random()*10));t.push(m)}return t};function je(){const[l,t]=u.useState(fe()),[x,m]=u.useState(2),[c,P]=u.useState(2),N=(C,f,E)=>{t(C),m(f),P(E)};return e.jsx("div",{className:"text-slate-900 dark:text-white",children:e.jsx("div",{className:"flex flex-col gap-4 max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1 bg-gray-50 rounded-xl shadow-lg overflow-hidden",children:e.jsx(he,{inputMatrix:l,poolSize:x,stride:c})}),e.jsx("div",{className:"flex-1 bg-gray-50 rounded-xl shadow-lg overflow-hidden",children:e.jsx(ge,{onParamsChange:N})})]})})})}export{je as default};
